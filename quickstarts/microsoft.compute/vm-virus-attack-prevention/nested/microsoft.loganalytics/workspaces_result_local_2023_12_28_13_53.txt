arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"omsWorkspaceName": {"type": "string", "defaultValue": "[concat(\'oms-workspace\',uniqueString(resourceGroup().id))]"}, "omsSolutionsName": {"type": "array", "defaultValue": "zytest"}, "tags": {"type": "object", "defaultValue": "zytest"}, "sku": {"type": "string", "allowedValues": ["Free", "Standalone", "PerNode"], "defaultValue": "Free", "metadata": {"description": "Service Tier: Free, Standalone, or PerNode"}}, "dataRetention": {"type": "int", "defaultValue": 90, "minValue": 7, "maxValue": 730, "metadata": {"description": "Number of days of retention. Free plans can only have 7 days, Standalone and OMS plans include 30 days for free"}}, "location": {"type": "string", "defaultValue": "westus"}}, "resources": [{"name": "[parameters(\'omsWorkspaceName\')]", "type": "Microsoft.OperationalInsights/workspaces", "apiVersion": "2021-06-01", "location": "[parameters(\'location\')]", "tags": "[parameters(\'tags\')]", "properties": {"sku": {"name": "[parameters(\'sku\')]"}, "retention": "[parameters(\'dataRetention\')]"}}, {"type": "Microsoft.OperationsManagement/solutions", "name": "[concat(parameters(\'omsSolutionsName\')[copyIndex()], \'(\', parameters(\'omsWorkspaceName\'), \')\')]", "apiVersion": "2015-11-01-preview", "location": "[parameters(\'location\')]", "dependsOn": ["[parameters(\'omsWorkspaceName\')]"], "copy": {"name": "copy-oms-solutions", "count": "[length(parameters(\'omsSolutionsName\'))]"}, "plan": {"name": "[concat(parameters(\'omsSolutionsName\')[copyIndex()], \'(\', parameters(\'omsWorkspaceName\'), \')\')]", "product": "[concat(\'OMSGallery/\', parameters(\'omsSolutionsName\')[copyIndex()])]", "promotionCode": "", "publisher": "Microsoft"}, "properties": {"workspaceResourceId": "[resourceId(\'Microsoft.OperationalInsights/workspaces\', parameters(\'omsWorkspaceName\'))]"}}, {"type": "Microsoft.OperationalInsights/workspaces/datasources", "kind": "AzureActivityLog", "name": "[concat(parameters(\'omsWorkspaceName\'), \'/\', subscription().subscriptionId)]", "apiVersion": "2020-08-01", "location": "[parameters(\'location\')]", "dependsOn": ["[parameters(\'omsWorkspaceName\')]"], "properties": {"linkedResourceId": "[subscriptionResourceId(\'microsoft.insights/eventTypes\', \'management\')]"}}], "outputs": {"workspaceName": {"type": "string", "value": "[parameters(\'omsWorkspaceName\')]"}}}


cli_script
Based on the provided JSON data, I will translate the ARM template into an equivalent Azure CLI script. First, I\'ll extract the parameters and then translate each resource into its corresponding CLI command.\n\n```bash\n#!/bin/bash\n\n# Parameters\nomsWorkspaceName=$(echo "oms-workspace$(az group show --query id --output tsv | tr -d \'\\n\' | sha1sum | head -c 10)")\nomsSolutionsName=("zytest")\ntags="zytest"\nsku="Free"\ndataRetention=90\nlocation="westus"\n\n# Create the Log Analytics workspace\naz monitor log-analytics workspace create \\\n    --workspace-name "$omsWorkspaceName" \\\n    --location "$location" \\\n    --tags "$tags" \\\n    --sku "$sku" \\\n    --retention-time "$dataRetention"\n# Explanation: This command creates a Log Analytics workspace with the given name, location, tags, SKU, and data retention policy.\n\n# Deploy the OMS solutions\nfor solution in "${omsSolutionsName[@]}"; do\n    solutionName="${solution}($omsWorkspaceName)"\n    planName="${solutionName}"\n    product="OMSGallery/${solution}"\n    publisher="Microsoft"\n\n    workspaceResourceId=$(az monitor log-analytics workspace show --workspace-name "$omsWorkspaceName" --query id --output tsv)\n\n    az monitor log-analytics solution create \\\n        --resource-group "$(az group show --query name --output tsv)" \\\n        --name "$solutionName" \\\n        --location "$location" \\\n        --workspace "$workspaceResourceId" \\\n        --plan-name "$planName" \\\n        --plan-product "$product" \\\n        --plan-publisher "$publisher"\n    # Explanation: This command creates an OMS solution for each entry in the omsSolutionsName array and associates it with the workspace.\ndone\n\n# Link the Azure Activity Log to the workspace\nactivityLogName="${omsWorkspaceName}/$(az account show --query id --output tsv)"\nlinkedResourceId=$(az resource show --resource-type microsoft.insights/eventTypes --name management --query id --output tsv)\n\naz monitor log-analytics workspace data-source create \\\n    --resource-group "$(az group show --query name --output tsv)" \\\n    --workspace-name "$omsWorkspaceName" \\\n    --name "$activityLogName" \\\n    --data-source-type "AzureActivityLog" \\\n    --linked-resource-id "$linkedResourceId"\n# Explanation: This command links the Azure Activity Log to the workspace, enabling the collection of activity logs.\n```\n\nPlease note that the actual subscription ID and resource group ID are dynamically obtained using `az account show` and `az group show` commands. The `sha1sum` command is used to simulate the `uniqueString()` function from ARM template to generate a unique workspace name. Also, the ARM template\'s `copy` loop for deploying multiple solutions is translated into a bash `for` loop.


verify_result
