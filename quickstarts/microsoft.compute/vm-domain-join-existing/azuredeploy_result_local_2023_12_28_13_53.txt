arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"vmList": {"type": "string", "minLength": 1, "metadata": {"description": "List of virtual machines to be domain joined, if using multiple VMs, make their names comma separate. E.g. VM01, VM02, VM03."}, "defaultValue": "zytest"}, "location": {"type": "string", "metadata": {"description": "Location name of the virtual machine"}, "defaultValue": "westus"}, "domainJoinUserName": {"type": "string", "metadata": {"description": "Domain NetBiosName plus User name of a domain user with sufficient rights to perfom domain join operation. E.g. domain\\\\username"}, "defaultValue": "zytest"}, "domainJoinUserPassword": {"type": "securestring", "metadata": {"description": "Domain user password"}, "defaultValue": "zytest"}, "domainFQDN": {"type": "string", "metadata": {"description": "Domain FQDN where the virtual machine will be joined"}, "defaultValue": "zytest"}, "ouPath": {"type": "string", "defaultValue": "", "metadata": {"description": "Specifies an organizational unit (OU) for the domain account. Enter the full distinguished name of the OU in quotation marks. Example: \\"OU=testOU; DC=domain; DC=Domain; DC=com\\""}}}, "variables": {"domainJoinOptions": 3, "vmListArray": "[split(parameters(\'vmList\'),\',\')]"}, "resources": [{"comments": "Join domain - JsonADDomainExtension", "apiVersion": "2015-06-15", "type": "Microsoft.Compute/virtualMachines/extensions", "name": "[concat(trim(variables(\'vmListArray\')[copyIndex()]),\'/joindomain\')]", "location": "[parameters(\'location\')]", "copy": {"name": "vmDomainJoinCopy", "count": "[length(variables(\'vmListArray\'))]"}, "properties": {"publisher": "Microsoft.Compute", "type": "JsonADDomainExtension", "typeHandlerVersion": "1.3", "autoUpgradeMinorVersion": true, "settings": {"Name": "[parameters(\'domainFQDN\')]", "User": "[parameters(\'domainJoinUserName\')]", "Restart": "true", "Options": "[variables(\'domainJoinOptions\')]", "OUPath": "[parameters(\'ouPath\')]"}, "protectedSettings": {"Password": "[parameters(\'domainJoinUserPassword\')]"}}}]}


cli_script
```bash\n#!/bin/bash\n\n# Define the parameter values as variables\nvmList="zytest"\nlocation="westus"\ndomainJoinUserName="zytest"\ndomainJoinUserPassword="zytest"\ndomainFQDN="zytest"\nouPath=""\n\n# Convert vmList to an array\nIFS=\',\' read -r -a vmListArray <<< "$vmList"\n\n# Define the domain join options\ndomainJoinOptions=3\n\n# Loop through each VM in the vmListArray and create the domain join extension\nfor vmName in "${vmListArray[@]}"; do\n    # Trim the VM name and create the domain join extension for each VM\n    trimmedVmName=$(echo "$vmName" | xargs)\n    vmExtensionName="${trimmedVmName}/joindomain"\n\n    # Join domain - JsonADDomainExtension\n    az vm extension set \\\n        --resource-group <ResourceGroupName> \\ # Replace <ResourceGroupName> with your actual resource group name\n        --vm-name "$trimmedVmName" \\\n        --name "joindomain" \\\n        --publisher "Microsoft.Compute" \\\n        --extension-type "JsonADDomainExtension" \\\n        --version "1.3" \\\n        --settings "{\\"Name\\": \\"$domainFQDN\\", \\"OUPath\\": \\"$ouPath\\", \\"User\\": \\"$domainJoinUserName\\", \\"Restart\\": \\"true\\", \\"Options\\": $domainJoinOptions}" \\\n        --protected-settings "{\\"Password\\": \\"$domainJoinUserPassword\\"}" \\\n        --location "$location"\ndone\n```\n\nPlease replace `<ResourceGroupName>` with your actual resource group name where the virtual machines are located. This script assumes you have the Azure CLI installed and you are logged in to your Azure account (`az login`). The script also assumes that the virtual machines already exist in the specified resource group. If you need to create the virtual machines or specify different resource groups for each, you would need to adjust the script accordingly.


verify_result
{"diff_info": ["  ", "  Thedeploymentwillupdatethefollowingscope:", "  ", "  Scope:/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg", "  ", "  -Microsoft.CognitiveServices/accounts/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.CognitiveServices/accounts/cli-translator\\"", "  identity.type:\\"None\\"", "  kind:\\"FormRecognizer\\"", "  location:\\"westus2\\"", "  name:\\"cli-translator\\"", "  sku.name:\\"F0\\"", "  type:\\"Microsoft.CognitiveServices/accounts\\"", "  ", "  -Microsoft.DocumentDb/databaseAccounts/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.DocumentDb/databaseAccounts/cli-translator\\"", "  identity.type:\\"None\\"", "  kind:\\"GlobalDocumentDB\\"", "  location:\\"westus\\"", "  name:\\"cli-translator\\"", "  tags.defaultExperience:\\"Core(SQL)\\"", "  type:\\"Microsoft.DocumentDb/databaseAccounts\\"", "  ", "  -Microsoft.Search/searchServices/customdatasearch", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Search/searchServices/customdatasearch\\"", "  location:\\"westus2\\"", "  name:\\"customdatasearch\\"", "  sku.name:\\"standard\\"", "  tags.ProjectType:\\"aoai-your-data-service\\"", "  type:\\"Microsoft.Search/searchServices\\"", "  ", "  -Microsoft.Storage/storageAccounts/clitranslatorapi", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Storage/storageAccounts/clitranslatorapi\\"", "  kind:\\"Storage\\"", "  location:\\"westus\\"", "  name:\\"clitranslatorapi\\"", "  sku.name:\\"Standard_LRS\\"", "  sku.tier:\\"Standard\\"", "  type:\\"Microsoft.Storage/storageAccounts\\"", "  ", "  -Microsoft.Storage/storageAccounts/customdataforgpt", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Storage/storageAccounts/customdataforgpt\\"", "  kind:\\"StorageV2\\"", "  location:\\"eastus\\"", "  name:\\"customdataforgpt\\"", "  sku.name:\\"Standard_RAGRS\\"", "  sku.tier:\\"Standard\\"", "  tags.ProjectType:\\"aoai-your-data-service\\"", "  type:\\"Microsoft.Storage/storageAccounts\\"", "  ", "  -Microsoft.Storage/storageAccounts/translatortempfiles", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Storage/storageAccounts/translatortempfiles\\"", "  kind:\\"StorageV2\\"", "  location:\\"eastasia\\"", "  name:\\"translatortempfiles\\"", "  sku.name:\\"Standard_LRS\\"", "  sku.tier:\\"Standard\\"", "  type:\\"Microsoft.Storage/storageAccounts\\"", "  ", "  -Microsoft.Web/serverFarms/ASP-clitranslatorrg-bdc9", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Web/serverFarms/ASP-clitranslatorrg-bdc9\\"", "  kind:\\"functionapp\\"", "  location:\\"westus\\"", "  name:\\"ASP-clitranslatorrg-bdc9\\"", "  sku.capacity:0", "  sku.family:\\"Y\\"", "  sku.name:\\"Y1\\"", "  sku.size:\\"Y1\\"", "  sku.tier:\\"Dynamic\\"", "  type:\\"Microsoft.Web/serverFarms\\"", "  ", "  -Microsoft.Web/sites/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Web/sites/cli-translator\\"", "  kind:\\"functionapp,linux\\"", "  location:\\"westus\\"", "  name:\\"cli-translator\\"", "  tags.hidden-link:/app-insights-conn-string:\\"InstrumentationKey=11b638ce-0c16-42cc-9516-58122a1922ef;IngestionEndpoint=https://westus-0.in.applicationinsights.azure.com/;LiveEndpoint=https://westus.livediagnostics.monitor.azure.com/\\"", "  tags.hidden-link:/app-insights-instrumentation-key:\\"11b638ce-0c16-42cc-9516-58122a1922ef\\"", "  tags.hidden-link:/app-insights-resource-id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/microsoft.insights/components/cli-translator\\"", "  type:\\"Microsoft.Web/sites\\"", "  ", "  -microsoft.alertsmanagement/smartDetectorAlertRules/FailureAnomalies-cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/microsoft.alertsmanagement/smartDetectorAlertRules/FailureAnomalies-cli-translator\\"", "  location:\\"global\\"", "  name:\\"FailureAnomalies-cli-translator\\"", "  type:\\"microsoft.alertsmanagement/smartDetectorAlertRules\\"", "  ", "  -microsoft.insights/components/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/microsoft.insights/components/cli-translator\\"", "  kind:\\"web\\"", "  location:\\"westus\\"", "  name:\\"cli-translator\\"", "  type:\\"microsoft.insights/components\\"", "  ", "  +Microsoft.Compute/virtualMachines/zytest/extensions/joindomain[]", "  ", "  apiVersion:\\"\\"", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Compute/virtualMachines/zytest/extensions/joindomain\\"", "  location:\\"westus\\"", "  name:\\"joindomain\\"", "  properties.autoUpgradeMinorVersion:true", "  properties.protectedSettings:\\"*******\\"", "  properties.publisher:\\"Microsoft.Compute\\"", "  properties.settings.Name:\\"zytest\\"", "  properties.settings.Options:3", "  properties.settings.Restart:\\"true\\"", "  properties.settings.User:\\"zytest\\"", "  properties.type:\\"JsonADDomainExtension\\"", "  properties.typeHandlerVersion:\\"1.3\\"", "  type:\\"Microsoft.Compute/virtualMachines/extensions\\"", "  ", "  Resourcechanges:10todelete,1tocreate."], "diff_summary": {"added": 0, "deleted": 0, "differential_rate": "0.000"}}