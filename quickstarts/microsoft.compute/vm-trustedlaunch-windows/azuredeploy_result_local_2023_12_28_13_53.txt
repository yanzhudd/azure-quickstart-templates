arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "metadata": {"_generator": {"name": "bicep", "version": "0.13.1.58284", "templateHash": "3609278246724858266"}}, "parameters": {"vmName": {"type": "string", "defaultValue": "myTVM", "metadata": {"description": "Name of the virtual machine."}}, "sku": {"type": "string", "defaultValue": "2022-datacenter-azure-edition", "allowedValues": ["RS1-EnterpriseN-G2", "RS5-EnterpriseN-Standard-G2", "RS5-EnterpriseN-G2", "19H2-Ent-G2", "20H2-ProN-G2", "20H1-ProN-G2", "20H1-Pro-ZH-CN-G2", "20H2-Pro-G2", "20H2-Ent-G2", "20H1-Pro-G2", "19H2-Pro-G2", "20H1-Ent-G2", "20H2-Pro-ZH-CN-G2", "19H2-EntN-G2", "19H2-Pro-ZH-CN-G2", "19H2-ProN-G2", "20H2-EntN-G2", "20H1-EntN-G2", "RS5-Enterprise-Standard-G2", "RS5-Enterprise-G2", "RS1-Enterprise-G2", "DataCenter-Core-1909-With-Containers-Smalldisk-G2", "2016-DataCenter-With-Containers-G2", "2019-DataCenter-GenSecond", "DataCenter-Core-2004-With-Containers-Smalldisk-G2", "2019-DataCenter-Core-G2", "2019-DataCenter-Core-Smalldisk-G2", "2016-DataCenter-ZHCN-G2", "DataCenter-Core-20H2-With-Containers-Smalldisk-G2", "2016-DataCenter-GenSecond", "2016-DataCenter-Server-Core-Smalldisk-G2", "2019-DataCenter-Smalldisk-G2", "2016-DataCenter-Server-Core-G2", "2016-DataCenter-Smalldisk-G2", "2019-DataCenter-Core-With-Containers-Smalldisk-G2", "2019-DataCenter-ZHCN-G2", "2019-DataCenter-Core-With-Containers-G2", "2019-DataCenter-With-Containers-Smalldisk-G2", "2019-DataCenter-With-Containers-G2", "2022-datacenter-azure-edition", "2022-datacenter-azure-edition-core", "2022-datacenter-azure-edition-core-smalldisk", "2022-datacenter-azure-edition-smalldisk", "2022-datacenter-core-g2", "2022-datacenter-core-smalldisk-g2", "2022-datacenter-g2", "2022-datacenter-smalldisk-g2"], "metadata": {"description": "The OS SKU for the virtual machine. This will pick a fully patched image of the given OS SKU."}}, "vmSize": {"type": "string", "defaultValue": "Standard_D2s_v3", "metadata": {"description": "Size of the virtual machine."}}, "adminUsername": {"type": "string", "metadata": {"description": "Username for the virtual machine."}, "defaultValue": "zytest"}, "adminPassword": {"type": "secureString", "minLength": 12, "metadata": {"description": "Password for the virtual machine."}, "defaultValue": "zytest"}, "secureBoot": {"type": "bool", "defaultValue": true, "metadata": {"description": "Secure Boot setting of the virtual machine."}}, "vTPM": {"type": "bool", "defaultValue": true, "metadata": {"description": "vTPM setting of the virtual machine."}}, "location": {"type": "string", "defaultValue": "westus", "metadata": {"description": "Location for all resources."}}, "dnsLabelPrefix": {"type": "string", "defaultValue": "[toLower(format(\'{0}-{1}\', parameters(\'vmName\'), uniqueString(resourceGroup().id)))]", "metadata": {"description": "Unique DNS Name for the Public IP used to access the virtual machine."}}, "publicIpName": {"type": "string", "defaultValue": "myPublicIP", "metadata": {"description": "Name for the Public IP used to access the virtual machine."}}, "publicIPAllocationMethod": {"type": "string", "defaultValue": "Dynamic", "allowedValues": ["Dynamic", "Static"], "metadata": {"description": "Allocation method for the Public IP used to access the virtual machine."}}, "publicIpSku": {"type": "string", "defaultValue": "Basic", "allowedValues": ["Basic", "Standard"], "metadata": {"description": "SKU for the Public IP used to access the virtual machine."}}, "nicName": {"type": "string", "defaultValue": "nic", "metadata": {"description": "Name of the network interface"}}, "virtualNetworkName": {"type": "string", "defaultValue": "vnet", "metadata": {"description": "Name of the virtual network"}}, "networkSecurityGroupName": {"type": "string", "defaultValue": "nsg", "metadata": {"description": "Name of the network security group"}}, "maaEndpoint": {"type": "string", "defaultValue": "", "metadata": {"description": "Custom Attestation Endpoint to attest to. By default, MAA and ASC endpoints are empty and Azure values are populated based on the location of the VM."}}}, "variables": {"imageReference": {"RS1-EnterpriseN-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "RS5-EnterpriseN-Standard-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "RS5-EnterpriseN-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "19H2-Ent-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "20H2-ProN-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "20H1-ProN-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "20H1-Pro-ZH-CN-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "20H2-Pro-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "20H2-Ent-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "20H1-Pro-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "19H2-Pro-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "20H1-Ent-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "20H2-Pro-ZH-CN-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "19H2-EntN-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "19H2-Pro-ZH-CN-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "19H2-ProN-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "20H2-EntN-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "20H1-EntN-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "RS5-Enterprise-Standard-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "RS5-Enterprise-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "RS1-Enterprise-G2": {"publisher": "MicrosoftWindowsDesktop", "offer": "Windows-10", "sku": "[parameters(\'sku\')]", "version": "latest"}, "DataCenter-Core-1909-With-Containers-Smalldisk-G2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2016-DataCenter-With-Containers-G2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2019-DataCenter-GenSecond": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "DataCenter-Core-2004-With-Containers-Smalldisk-G2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2019-DataCenter-Core-G2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2019-DataCenter-Core-Smalldisk-G2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2016-DataCenter-ZHCN-G2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "DataCenter-Core-20H2-With-Containers-Smalldisk-G2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2016-DataCenter-GenSecond": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2016-DataCenter-Server-Core-Smalldisk-G2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2019-DataCenter-Smalldisk-G2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2016-DataCenter-Server-Core-G2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2016-DataCenter-Smalldisk-G2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2019-DataCenter-Core-With-Containers-Smalldisk-G2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2019-DataCenter-ZHCN-G2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2019-DataCenter-Core-With-Containers-G2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2019-DataCenter-With-Containers-Smalldisk-G2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2019-DataCenter-With-Containers-G2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2022-datacenter-azure-edition": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2022-datacenter-azure-edition-core": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2022-datacenter-azure-edition-core-smalldisk": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2022-datacenter-azure-edition-smalldisk": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2022-datacenter-core-g2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2022-datacenter-core-smalldisk-g2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2022-datacenter-g2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}, "2022-datacenter-smalldisk-g2": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "[parameters(\'sku\')]", "version": "latest"}}, "addressPrefix": "10.0.0.0/16", "disableAlerts": "false", "extensionName": "GuestAttestation", "extensionPublisher": "Microsoft.Azure.Security.WindowsAttestation", "extensionVersion": "1.0", "maaTenantName": "GuestAttestation", "subnetName": "Subnet", "subnetPrefix": "10.0.0.0/24", "subnetRef": "[resourceId(\'Microsoft.Network/virtualNetworks/subnets\', parameters(\'virtualNetworkName\'), variables(\'subnetName\'))]", "useAlternateToken": "false"}, "resources": [{"type": "Microsoft.Network/publicIPAddresses", "apiVersion": "2022-05-01", "name": "[parameters(\'publicIpName\')]", "location": "[parameters(\'location\')]", "sku": {"name": "[parameters(\'publicIpSku\')]"}, "properties": {"publicIPAllocationMethod": "[parameters(\'publicIPAllocationMethod\')]", "dnsSettings": {"domainNameLabel": "[parameters(\'dnsLabelPrefix\')]"}}}, {"type": "Microsoft.Network/networkSecurityGroups", "apiVersion": "2022-05-01", "name": "[parameters(\'networkSecurityGroupName\')]", "location": "[parameters(\'location\')]", "properties": {"securityRules": [{"name": "default-allow-3389", "properties": {"priority": 1000, "access": "Allow", "direction": "Inbound", "destinationPortRange": "3389", "protocol": "Tcp", "sourcePortRange": "*", "sourceAddressPrefix": "*", "destinationAddressPrefix": "*"}}]}}, {"type": "Microsoft.Network/virtualNetworks", "apiVersion": "2022-05-01", "name": "[parameters(\'virtualNetworkName\')]", "location": "[parameters(\'location\')]", "properties": {"addressSpace": {"addressPrefixes": ["[variables(\'addressPrefix\')]"]}, "subnets": [{"name": "[variables(\'subnetName\')]", "properties": {"addressPrefix": "[variables(\'subnetPrefix\')]", "networkSecurityGroup": {"id": "[resourceId(\'Microsoft.Network/networkSecurityGroups\', parameters(\'networkSecurityGroupName\'))]"}}}]}, "dependsOn": ["[resourceId(\'Microsoft.Network/networkSecurityGroups\', parameters(\'networkSecurityGroupName\'))]"]}, {"type": "Microsoft.Network/networkInterfaces", "apiVersion": "2022-05-01", "name": "[parameters(\'nicName\')]", "location": "[parameters(\'location\')]", "properties": {"ipConfigurations": [{"name": "ipconfig1", "properties": {"privateIPAllocationMethod": "Dynamic", "publicIPAddress": {"id": "[resourceId(\'Microsoft.Network/publicIPAddresses\', parameters(\'publicIpName\'))]"}, "subnet": {"id": "[variables(\'subnetRef\')]"}}}]}, "dependsOn": ["[resourceId(\'Microsoft.Network/publicIPAddresses\', parameters(\'publicIpName\'))]", "[resourceId(\'Microsoft.Network/virtualNetworks\', parameters(\'virtualNetworkName\'))]"]}, {"type": "Microsoft.Compute/virtualMachines", "apiVersion": "2022-03-01", "name": "[parameters(\'vmName\')]", "location": "[parameters(\'location\')]", "identity": {"type": "SystemAssigned"}, "properties": {"hardwareProfile": {"vmSize": "[parameters(\'vmSize\')]"}, "osProfile": {"computerName": "[parameters(\'vmName\')]", "adminUsername": "[parameters(\'adminUsername\')]", "adminPassword": "[parameters(\'adminPassword\')]"}, "storageProfile": {"imageReference": "[variables(\'imageReference\')[parameters(\'sku\')]]", "osDisk": {"createOption": "FromImage", "managedDisk": {"storageAccountType": "StandardSSD_LRS"}}}, "networkProfile": {"networkInterfaces": [{"id": "[resourceId(\'Microsoft.Network/networkInterfaces\', parameters(\'nicName\'))]"}]}, "securityProfile": {"uefiSettings": {"secureBootEnabled": "[parameters(\'secureBoot\')]", "vTpmEnabled": "[parameters(\'vTPM\')]"}, "securityType": "TrustedLaunch"}}, "dependsOn": ["[resourceId(\'Microsoft.Network/networkInterfaces\', parameters(\'nicName\'))]"]}, {"condition": "[and(parameters(\'vTPM\'), parameters(\'secureBoot\'))]", "type": "Microsoft.Compute/virtualMachines/extensions", "apiVersion": "2022-03-01", "name": "[format(\'{0}/{1}\', parameters(\'vmName\'), variables(\'extensionName\'))]", "location": "[parameters(\'location\')]", "properties": {"publisher": "[variables(\'extensionPublisher\')]", "type": "[variables(\'extensionName\')]", "typeHandlerVersion": "[variables(\'extensionVersion\')]", "autoUpgradeMinorVersion": true, "settings": {"AttestationConfig": {"MaaSettings": {"maaEndpoint": "[parameters(\'maaEndpoint\')]", "maaTenantName": "[variables(\'maaTenantName\')]"}, "AscSettings": {"ascReportingEndpoint": "[substring(parameters(\'maaEndpoint\'), 0, 0)]", "ascReportingFrequency": "[substring(parameters(\'maaEndpoint\'), 0, 0)]"}, "useCustomToken": "[variables(\'useAlternateToken\')]", "disableAlerts": "[variables(\'disableAlerts\')]"}}}, "dependsOn": ["[resourceId(\'Microsoft.Compute/virtualMachines\', parameters(\'vmName\'))]"]}], "outputs": {"hostname": {"type": "string", "value": "[reference(resourceId(\'Microsoft.Network/publicIPAddresses\', parameters(\'publicIpName\')), \'2022-05-01\').dnsSettings.fqdn]"}}}


cli_script
Below is the translated Azure CLI script from the provided ARM template and parameters:\n\n```bash\n#!/bin/bash\n\n# Define variables from template parameters\nvmName="myTVM"\nsku="2022-datacenter-azure-edition"\nvmSize="Standard_D2s_v3"\nadminUsername="zytest"\nadminPassword="zytest" # Note: In production, secure handling of passwords is necessary\nsecureBoot=true\nvTPM=true\nlocation="westus"\n# The dnsLabelPrefix is a function in ARM and needs to be generated in the script\ndnsLabelPrefix=$(echo $vmName | tr \'[:upper:]\' \'[:lower:]\')-$(echo -n $location | md5sum | cut -d\' \' -f1)\npublicIpName="myPublicIP"\npublicIPAllocationMethod="Dynamic"\npublicIpSku="Basic"\nnicName="nic"\nvirtualNetworkName="vnet"\nnetworkSecurityGroupName="nsg"\nmaaEndpoint=""\n\n# Define variables from template variables\naddressPrefix="10.0.0.0/16"\nsubnetName="Subnet"\nsubnetPrefix="10.0.0.0/24"\n\n# Create Public IP Address\naz network public-ip create \\\n    --name $publicIpName \\\n    --location $location \\\n    --allocation-method $publicIPAllocationMethod \\\n    --sku $publicIpSku \\\n    --dns-name $dnsLabelPrefix \\\n    --resource-group <ResourceGroup> # Replace <ResourceGroup> with your actual resource group name\n\n# Create Network Security Group and Rule\naz network nsg create \\\n    --name $networkSecurityGroupName \\\n    --location $location \\\n    --resource-group <ResourceGroup>\n\naz network nsg rule create \\\n    --nsg-name $networkSecurityGroupName \\\n    --name default-allow-3389 \\\n    --priority 1000 \\\n    --access Allow \\\n    --direction Inbound \\\n    --destination-port-ranges 3389 \\\n    --protocol Tcp \\\n    --source-port-ranges \'*\' \\\n    --source-address-prefix \'*\' \\\n    --destination-address-prefix \'*\' \\\n    --resource-group <ResourceGroup>\n\n# Create Virtual Network and Subnet\naz network vnet create \\\n    --name $virtualNetworkName \\\n    --location $location \\\n    --address-prefix $addressPrefix \\\n    --subnet-name $subnetName \\\n    --subnet-prefix $subnetPrefix \\\n    --network-security-group $networkSecurityGroupName \\\n    --resource-group <ResourceGroup>\n\n# Create Network Interface\naz network nic create \\\n    --name $nicName \\\n    --location $location \\\n    --vnet-name $virtualNetworkName \\\n    --subnet $subnetName \\\n    --public-ip-address $publicIpName \\\n    --resource-group <ResourceGroup>\n\n# Create Virtual Machine\naz vm create \\\n    --name $vmName \\\n    --location $location \\\n    --nics $nicName \\\n    --size $vmSize \\\n    --image $sku \\\n    --admin-username $adminUsername \\\n    --admin-password $adminPassword \\\n    --authentication-type password \\\n    --os-disk-size-gb 30 \\\n    --os-disk-caching ReadWrite \\\n    --os-disk-storage-account-type StandardSSD_LRS \\\n    --resource-group <ResourceGroup> \\\n    --security-type TrustedLaunch \\\n    --enable-secure-boot $secureBoot \\\n    --enable-vtpm $vTPM\n\n# Create Virtual Machine Extension (if vTPM and secureBoot are enabled)\nif [ "$vTPM" = true ] && [ "$secureBoot" = true ]; then\n    az vm extension set \\\n        --vm-name $vmName \\\n        --name GuestAttestation \\\n        --publisher Microsoft.Azure.Security.WindowsAttestation \\\n        --version 1.0 \\\n        --settings \'{"AttestationConfig":{"MaaSettings":{"maaEndpoint":"\'"$maaEndpoint"\'","maaTenantName":"GuestAttestation"},"AscSettings":{"ascReportingEndpoint":"","ascReportingFrequency":""},"useCustomToken":false,"disableAlerts":false}}\' \\\n        --resource-group <ResourceGroup>\nfi\n\n# Output the hostname\nhostname=$(az network public-ip show \\\n    --name $publicIpName \\\n    --query "dnsSettings.fqdn" \\\n    --output tsv \\\n    --resource-group <ResourceGroup>)\necho "Hostname: $hostname"\n```\n\nPlease replace `<ResourceGroup>` with the actual name of your Azure resource group. Additionally, ensure that you handle sensitive data like passwords securely. The `dnsLabelPrefix` in the script is an approximation of the ARM template function and may need to be adjusted depending on your requirements.


verify_result
