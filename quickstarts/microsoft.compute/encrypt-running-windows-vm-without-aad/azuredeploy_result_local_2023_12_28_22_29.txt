arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"vmName": {"type": "string", "metadata": {"description": "Name of the virtual machine"}, "defaultValue": "zytest"}, "keyVaultName": {"type": "string", "metadata": {"description": "Name of the KeyVault to place the volume encryption key"}, "defaultValue": "zytest"}, "keyVaultResourceGroup": {"type": "string", "metadata": {"description": "Resource group of the KeyVault"}, "defaultValue": "zytest"}, "keyEncryptionKeyURL": {"type": "string", "defaultValue": "", "metadata": {"description": "URL of the KeyEncryptionKey used to encrypt the volume encryption key"}}, "volumeType": {"type": "string", "defaultValue": "All", "metadata": {"description": "Type of the volume OS or Data to perform encryption operation"}}, "forceUpdateTag": {"type": "string", "defaultValue": "1.0", "metadata": {"description": "Pass in an unique value like a GUID everytime the operation needs to be force run"}}, "resizeOSDisk": {"type": "bool", "defaultValue": false, "metadata": {"description": "Should the OS partition be resized to occupy full OS VHD before splitting system volume"}}, "location": {"type": "string", "defaultValue": "westus", "metadata": {"description": "Location for all resources."}}}, "variables": {"extensionName": "AzureDiskEncryption", "extensionVersion": "2.2", "encryptionOperation": "EnableEncryption", "keyEncryptionAlgorithm": "RSA-OAEP", "keyVaultResourceID": "[resourceId(parameters(\'keyVaultResourceGroup\'), \'Microsoft.KeyVault/vaults/\', parameters(\'keyVaultName\'))]"}, "resources": [{"type": "Microsoft.Compute/virtualMachines/extensions", "name": "[concat(parameters(\'vmName\'),\'/\', variables(\'extensionName\'))]", "location": "[parameters(\'location\')]", "apiVersion": "2020-06-01", "properties": {"publisher": "Microsoft.Azure.Security", "type": "[variables(\'extensionName\')]", "typeHandlerVersion": "[variables(\'extensionVersion\')]", "autoUpgradeMinorVersion": true, "forceUpdateTag": "[parameters(\'forceUpdateTag\')]", "settings": {"EncryptionOperation": "[variables(\'encryptionOperation\')]", "KeyVaultURL": "[reference(variables(\'keyVaultResourceId\'), \'2019-09-01\').vaultUri]", "KeyVaultResourceId": "[variables(\'keyVaultResourceID\')]", "KeyEncryptionKeyURL": "[parameters(\'keyEncryptionKeyURL\')]", "KekVaultResourceId": "[variables(\'keyVaultResourceID\')]", "KeyEncryptionAlgorithm": "[variables(\'keyEncryptionAlgorithm\')]", "VolumeType": "[parameters(\'volumeType\')]", "ResizeOSDisk": "[parameters(\'resizeOSDisk\')]"}}}]}


cli_script
Below is the translated bash script equivalent for the provided ARM template and parameters:\n\n```bash\n#!/bin/bash\n\n# Parameters\nvmName="zytest"\nkeyVaultName="zytest"\nkeyVaultResourceGroup="zytest"\nkeyEncryptionKeyURL=""\nvolumeType="All"\nforceUpdateTag="1.0"\nresizeOSDisk=false\nlocation="westus"\n\n# Variables\nextensionName="AzureDiskEncryption"\nextensionVersion="2.2"\nencryptionOperation="EnableEncryption"\nkeyEncryptionAlgorithm="RSA-OAEP"\n# Retrieve the KeyVault Resource ID\nkeyVaultResourceID=$(az keyvault show --name $keyVaultName --resource-group $keyVaultResourceGroup --query "id" -o tsv)\n\n# Resource: Microsoft.Compute/virtualMachines/extensions\n# Enable encryption on the virtual machine\naz vm extension set \\\n  --resource-group $keyVaultResourceGroup \\\n  --vm-name $vmName \\\n  --name $extensionName \\\n  --publisher "Microsoft.Azure.Security" \\\n  --version $extensionVersion \\\n  --settings "{\\"EncryptionOperation\\":\\"$encryptionOperation\\", \\"KeyVaultURL\\":\\"$(az keyvault show --name $keyVaultName --resource-group $keyVaultResourceGroup --query "properties.vaultUri" -o tsv)\\", \\"KeyVaultResourceId\\":\\"$keyVaultResourceID\\", \\"KeyEncryptionKeyURL\\":\\"$keyEncryptionKeyURL\\", \\"KekVaultResourceId\\":\\"$keyVaultResourceID\\", \\"KeyEncryptionAlgorithm\\":\\"$keyEncryptionAlgorithm\\", \\"VolumeType\\":\\"$volumeType\\", \\"ResizeOSDisk\\":$resizeOSDisk}" \\\n  --location $location \\\n  --force-update-tag $forceUpdateTag \\\n  --no-wait\n\n# Note: The --no-wait flag is used to return control to the prompt immediately without waiting for the operation to complete.\n```\n\nPlease note that the `az keyvault show` command is used to retrieve the KeyVault Resource ID and the KeyVault URL. The ARM template\'s `reference` function is not directly translatable to CLI, so we use the `az keyvault show` command instead. Additionally, the `--no-wait` flag is used in the `az vm extension set` command to allow the script to continue without waiting for the operation to complete, which may be desirable for automation purposes. If you want to wait for the operation to complete before continuing, you can remove the `--no-wait` flag.


verify_result
{"diff_info": ["  ", "  Thedeploymentwillupdatethefollowingscope:", "  ", "  Scope:/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg", "  ", "  -Microsoft.CognitiveServices/accounts/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.CognitiveServices/accounts/cli-translator\\"", "  identity.type:\\"None\\"", "  kind:\\"FormRecognizer\\"", "  location:\\"westus2\\"", "  name:\\"cli-translator\\"", "  sku.name:\\"F0\\"", "  type:\\"Microsoft.CognitiveServices/accounts\\"", "  ", "  -Microsoft.DocumentDb/databaseAccounts/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.DocumentDb/databaseAccounts/cli-translator\\"", "  identity.type:\\"None\\"", "  kind:\\"GlobalDocumentDB\\"", "  location:\\"westus\\"", "  name:\\"cli-translator\\"", "  tags.defaultExperience:\\"Core(SQL)\\"", "  type:\\"Microsoft.DocumentDb/databaseAccounts\\"", "  ", "  -Microsoft.Search/searchServices/customdatasearch", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Search/searchServices/customdatasearch\\"", "  location:\\"westus2\\"", "  name:\\"customdatasearch\\"", "  sku.name:\\"standard\\"", "  tags.ProjectType:\\"aoai-your-data-service\\"", "  type:\\"Microsoft.Search/searchServices\\"", "  ", "  -Microsoft.Storage/storageAccounts/clitranslatorapi", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Storage/storageAccounts/clitranslatorapi\\"", "  kind:\\"Storage\\"", "  location:\\"westus\\"", "  name:\\"clitranslatorapi\\"", "  sku.name:\\"Standard_LRS\\"", "  sku.tier:\\"Standard\\"", "  type:\\"Microsoft.Storage/storageAccounts\\"", "  ", "  -Microsoft.Storage/storageAccounts/customdataforgpt", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Storage/storageAccounts/customdataforgpt\\"", "  kind:\\"StorageV2\\"", "  location:\\"eastus\\"", "  name:\\"customdataforgpt\\"", "  sku.name:\\"Standard_RAGRS\\"", "  sku.tier:\\"Standard\\"", "  tags.ProjectType:\\"aoai-your-data-service\\"", "  type:\\"Microsoft.Storage/storageAccounts\\"", "  ", "  -Microsoft.Storage/storageAccounts/translatortempfiles", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Storage/storageAccounts/translatortempfiles\\"", "  kind:\\"StorageV2\\"", "  location:\\"eastasia\\"", "  name:\\"translatortempfiles\\"", "  sku.name:\\"Standard_LRS\\"", "  sku.tier:\\"Standard\\"", "  type:\\"Microsoft.Storage/storageAccounts\\"", "  ", "  -Microsoft.Web/serverFarms/ASP-clitranslatorrg-bdc9", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Web/serverFarms/ASP-clitranslatorrg-bdc9\\"", "  kind:\\"functionapp\\"", "  location:\\"westus\\"", "  name:\\"ASP-clitranslatorrg-bdc9\\"", "  sku.capacity:0", "  sku.family:\\"Y\\"", "  sku.name:\\"Y1\\"", "  sku.size:\\"Y1\\"", "  sku.tier:\\"Dynamic\\"", "  type:\\"Microsoft.Web/serverFarms\\"", "  ", "  -Microsoft.Web/sites/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Web/sites/cli-translator\\"", "  kind:\\"functionapp,linux\\"", "  location:\\"westus\\"", "  name:\\"cli-translator\\"", "  tags.hidden-link:/app-insights-conn-string:\\"InstrumentationKey=11b638ce-0c16-42cc-9516-58122a1922ef;IngestionEndpoint=https://westus-0.in.applicationinsights.azure.com/;LiveEndpoint=https://westus.livediagnostics.monitor.azure.com/\\"", "  tags.hidden-link:/app-insights-instrumentation-key:\\"11b638ce-0c16-42cc-9516-58122a1922ef\\"", "  tags.hidden-link:/app-insights-resource-id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/microsoft.insights/components/cli-translator\\"", "  type:\\"Microsoft.Web/sites\\"", "  ", "  -microsoft.alertsmanagement/smartDetectorAlertRules/FailureAnomalies-cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/microsoft.alertsmanagement/smartDetectorAlertRules/FailureAnomalies-cli-translator\\"", "  location:\\"global\\"", "  name:\\"FailureAnomalies-cli-translator\\"", "  type:\\"microsoft.alertsmanagement/smartDetectorAlertRules\\"", "  ", "  -microsoft.insights/components/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/microsoft.insights/components/cli-translator\\"", "  kind:\\"web\\"", "  location:\\"westus\\"", "  name:\\"cli-translator\\"", "  type:\\"microsoft.insights/components\\"", "  ", "  +Microsoft.Compute/virtualMachines/zytest/extensions/AzureDiskEncryption[]", "  ", "  apiVersion:\\"\\"", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Compute/virtualMachines/zytest/extensions/AzureDiskEncryption\\"", "  location:\\"westus\\"", "  name:\\"AzureDiskEncryption\\"", "  properties.autoUpgradeMinorVersion:true", "- properties.forceUpdateTag:\\"1.0\\"", "+ properties.protectedSettings:\\"*******\\"", "  properties.publisher:\\"Microsoft.Azure.Security\\"", "  properties.settings.EncryptionOperation:\\"EnableEncryption\\"", "  properties.settings.KekVaultResourceId:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/zytest/providers/Microsoft.KeyVault/vaults/zytest\\"", "  properties.settings.KeyEncryptionAlgorithm:\\"RSA-OAEP\\"", "  properties.settings.KeyVaultResourceId:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/zytest/providers/Microsoft.KeyVault/vaults/zytest\\"", "- properties.settings.KeyVaultURL:\\"[reference(variables(\'keyVaultResourceId\'),\'\').vaultUri]\\"", "+ properties.settings.KeyVaultURL:\\"[reference(resourceId(parameters(\'keyVaultResourceGroup\'),\'Microsoft.KeyVault/vaults\',parameters(\'keyVaultName\')),\'\').vaultUri]\\"", "  properties.settings.ResizeOSDisk:false", "  properties.settings.VolumeType:\\"All\\"", "  properties.type:\\"AzureDiskEncryption\\"", "  properties.typeHandlerVersion:\\"2.2\\"", "  type:\\"Microsoft.Compute/virtualMachines/extensions\\"", "  ", "  Resourcechanges:10todelete,1tocreate."], "diff_summary": {"added": 2, "deleted": 2, "differential_rate": "0.032"}}