arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"namingInfix": {"type": "string", "metadata": {"description": "Naming infix of existing VM Scale Set."}, "defaultValue": "zytest"}, "location": {"type": "string", "defaultValue": "westus", "metadata": {"description": "Default location"}}}, "resources": [{"type": "Microsoft.Insights/autoscaleSettings", "apiVersion": "2015-04-01", "name": "autoscalewad", "location": "[parameters(\'location\')]", "properties": {"name": "autoscalewad", "targetResourceUri": "[resourceId(\'Microsoft.Compute/virtualMachineScaleSets/\', parameters(\'namingInfix\'))]", "enabled": true, "profiles": [{"name": "Profile1", "capacity": {"minimum": "1", "maximum": "10", "default": "1"}, "rules": [{"metricTrigger": {"metricName": "Percentage CPU", "metricResourceUri": "[resourceId(\'Microsoft.Compute/virtualMachineScaleSets/\', parameters(\'namingInfix\'))]", "timeGrain": "PT1M", "statistic": "Average", "timeWindow": "PT5M", "timeAggregation": "Average", "operator": "GreaterThan", "threshold": 60}, "scaleAction": {"direction": "Increase", "type": "ChangeCount", "value": "3", "cooldown": "PT1M"}}, {"metricTrigger": {"metricName": "Percentage CPU", "metricResourceUri": "[resourceId(\'Microsoft.Compute/virtualMachineScaleSets/\', parameters(\'namingInfix\'))]", "timeGrain": "PT1M", "statistic": "Average", "timeWindow": "PT5M", "timeAggregation": "Average", "operator": "LessThan", "threshold": 30}, "scaleAction": {"direction": "Decrease", "type": "ChangeCount", "value": "1", "cooldown": "PT5M"}}]}]}}]}


cli_script
Here is the equivalent CLI script:\n\n```bash\n#!/bin/bash\n\n# Define parameters\nnamingInfix="zytest"\nlocation="westus"\n\n# Create Microsoft.Insights/autoscaleSettings resource\naz monitor autoscale create \\\n  --resource-group myResourceGroup \\\n  --resource "Microsoft.Compute/virtualMachineScaleSets/$namingInfix" \\\n  --name autoscalewad \\\n  --location $location \\\n  --min-count 1 \\\n  --max-count 10 \\\n  --count 1 \\\n  --email-administrator-on-overage true\n\n# Add scale rule for CPU usage > 60%\naz monitor autoscale rule create \\\n  --resource-group myResourceGroup \\\n  --autoscale-name autoscalewad \\\n  --scale out 3 \\\n  --condition "Percentage CPU > 60 avg 5m" \\\n  --cooldown 1\n\n# Add scale rule for CPU usage < 30%\naz monitor autoscale rule create \\\n  --resource-group myResourceGroup \\\n  --autoscale-name autoscalewad \\\n  --scale in 1 \\\n  --condition "Percentage CPU < 30 avg 5m" \\\n  --cooldown 5\n```\n\nPlease replace `myResourceGroup` with your actual resource group name. This script creates an autoscale setting for a VM scale set and adds two rules: one to scale out (add instances) when the average CPU usage over 5 minutes is greater than 60%, and another to scale in (remove instances) when the average CPU usage over 5 minutes is less than 30%.


verify_result
