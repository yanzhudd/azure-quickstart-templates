arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"_artifactsLocation": {"type": "string", "metadata": {"description": "The base URI where artifacts required by this template are located. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated."}, "defaultValue": "[deployment().properties.templateLink.uri]"}, "_artifactsLocationSasToken": {"type": "securestring", "metadata": {"description": "The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated."}, "defaultValue": ""}, "vmPrefix": {"type": "string", "metadata": {"description": "Naming prefix applied to the deployed VM resources"}, "defaultValue": "zytest"}, "numberOfInstances": {"type": "int", "minValue": 1, "maxValue": 10, "metadata": {"description": "Number of VMs"}, "defaultValue": "zytest"}, "glassfishVersion": {"type": "int", "minValue": 3, "maxValue": 4, "allowedValues": [3, 4], "metadata": {"description": "Release number for the GlassFish package to be deployed"}, "defaultValue": "zytest"}, "glassfishRelease": {"type": "string", "allowedValues": ["3.1.1", "3.1.2", "3.1.2.2", "3.2", "4.0", "4.1"], "metadata": {"description": "Version of GlassFish to deploy"}, "defaultValue": "zytest"}, "glassfishAdminPassword": {"type": "securestring", "metadata": {"description": "GlassFish admin user password"}, "defaultValue": "zytest"}, "location": {"type": "string", "defaultValue": "westus", "metadata": {"description": "Location for all resources."}}}, "variables": {"location": "[parameters(\'location\')]", "deploymentScriptFolder": "scripts/", "deploymentScriptFileName": "deployGlassFish.sh", "deploymentScriptUrl": "[uri(parameters(\'_artifactsLocation\'), concat(variables(\'deploymentScriptFolder\'), variables(\'deploymentScriptFileName\'), parameters(\'_artifactsLocationSasToken\')))]"}, "resources": [{"type": "Microsoft.Compute/virtualMachines/extensions", "name": "[concat(parameters(\'vmPrefix\'), copyIndex(), \'/deployGlassFish\')]", "location": "[variables(\'location\')]", "apiVersion": "2020-12-01", "tags": {"displayName": "deployGlassFish"}, "copy": {"name": "vmDeploymentScriptLoop", "count": "[parameters(\'numberOfInstances\')]"}, "properties": {"publisher": "Microsoft.Azure.Extensions", "type": "CustomScript", "typeHandlerVersion": "2.0", "autoUpgradeMinorVersion": true, "settings": {"fileUris": ["[variables(\'deploymentScriptUrl\')]"]}, "protectedSettings": {"commandToExecute": "[concat(\'sudo bash \', variables(\'deploymentScriptFileName\'), \' \', parameters(\'glassfishVersion\'), \' \', parameters(\'glassfishRelease\'), \' \', parameters(\'glassfishAdminPassword\'))]"}}}], "outputs": {}}


cli_script
Based on the provided ARM template and parameters, the following bash script can be used to deploy the resources using Azure CLI:\n\n```bash\n#!/bin/bash\n\n# Parameters\n_artifactsLocation="[deployment().properties.templateLink.uri]"\n_artifactsLocationSasToken=""\nvmPrefix="zytest"\nnumberOfInstances=1\nglassfishVersion=4\nglassfishRelease="4.1"\nglassfishAdminPassword="zytest"\nlocation="westus"\n\n# Variables\ndeploymentScriptFolder="scripts/"\ndeploymentScriptFileName="deployGlassFish.sh"\ndeploymentScriptUrl="${_artifactsLocation}${deploymentScriptFolder}${deploymentScriptFileName}${_artifactsLocationSasToken}"\n\n# Deploy the CustomScript extension to the virtual machines\nfor ((i=0; i<numberOfInstances; i++))\ndo\n  vmName="${vmPrefix}${i}"\n  extensionName="deployGlassFish"\n  vmExtensionName="${vmName}/${extensionName}"\n\n  # Command to execute on the virtual machine(s)\n  commandToExecute="sudo bash ${deploymentScriptFileName} ${glassfishVersion} ${glassfishRelease} ${glassfishAdminPassword}"\n\n  az vm extension set \\\n    --resource-group <ResourceGroupName> \\\n    --vm-name $vmName \\\n    --name $extensionName \\\n    --publisher Microsoft.Azure.Extensions \\\n    --version 2.0 \\\n    --settings "{\\"fileUris\\": [\\"${deploymentScriptUrl}\\"]}" \\\n    --protected-settings "{\\"commandToExecute\\": \\"${commandToExecute}\\"}" \\\n    --location $location \\\n    --tags displayName=deployGlassFish\ndone\n\n# Note: Replace <ResourceGroupName> with your actual resource group name.\n```\n\nPlease note the following when using this script:\n- Replace `<ResourceGroupName>` with the actual name of your resource group.\n- The script assumes that the virtual machines have already been created and are named according to the `vmPrefix` and a numeric index (e.g., `zytest0`, `zytest1`, etc.).\n- The `numberOfInstances` variable determines how many virtual machines the script will configure.\n- The `location` should be the same as the location where the virtual machines are deployed.\n- The `commandToExecute` variable contains the command that will be run on the virtual machines. It uses the `deploymentScriptFileName`, `glassfishVersion`, `glassfishRelease`, and `glassfishAdminPassword` to construct the command.\n- The `az vm extension set` command is used to deploy the CustomScript extension to each virtual machine. The settings and protected settings are passed as JSON strings.\n- Make sure to log in to your Azure account using `az login` before executing the script.


verify_result
