arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"newStorageAccountName": {"type": "string", "metadata": {"description": "Name of new storage account"}, "defaultValue": "zytest"}, "storageAccountType": {"type": "string", "defaultValue": "Standard_LRS", "allowedValues": ["Standard_LRS", "Standard_GRS"], "metadata": {"description": "Type of storage account"}}, "publicIPName": {"type": "string", "metadata": {"description": "Name of Public IP"}, "defaultValue": "zytest"}, "publicIPAddressType": {"type": "string", "defaultValue": "Dynamic", "allowedValues": ["Dynamic"], "metadata": {"description": "Type of Public Address"}}, "vmName": {"type": "string", "metadata": {"description": "Name of the VM"}, "defaultValue": "zytest"}, "vmSize": {"type": "string", "defaultValue": "Standard_A1_v2", "metadata": {"description": "Size of the VM"}}, "imagePublisher": {"type": "string", "defaultValue": "Canonical", "metadata": {"description": "Image Publisher"}}, "imageOffer": {"type": "string", "defaultValue": "UbuntuServer", "metadata": {"description": "Image Offer"}}, "imageSKU": {"type": "string", "defaultValue": "18.04-LTS", "allowedValues": ["14.04.5-LTS", "16.04-LTS", "18.04-LTS"], "metadata": {"description": "Image SKU"}}, "adminUsername": {"type": "string", "metadata": {"description": "VM Admin Username"}, "defaultValue": "zytest"}, "virtualNetworkName": {"type": "string", "metadata": {"description": "VNET Name"}, "defaultValue": "zytest"}, "virtualNetworkResourceGroup": {"type": "string", "metadata": {"description": "Resource Group VNET is deployed in"}, "defaultValue": "zytest"}, "subnet1Name": {"type": "string", "metadata": {"description": "Name of the subnet inside the VNET"}, "defaultValue": "zytest"}, "nicName": {"type": "string", "metadata": {"description": "Network Interface Name"}, "defaultValue": "zytest"}, "location": {"type": "string", "defaultValue": "westus", "metadata": {"description": "Location for all resources."}}, "authenticationType": {"type": "string", "defaultValue": "sshPublicKey", "allowedValues": ["sshPublicKey", "password"], "metadata": {"description": "Type of authentication to use on the Virtual Machine. SSH key is recommended."}}, "adminPasswordOrKey": {"type": "securestring", "metadata": {"description": "SSH Key or password for the Virtual Machine. SSH key is recommended."}, "defaultValue": "zytest"}}, "variables": {"linuxConfiguration": {"disablePasswordAuthentication": true, "ssh": {"publicKeys": [{"path": "[concat(\'/home/\', parameters(\'adminUsername\'), \'/.ssh/authorized_keys\')]", "keyData": "[parameters(\'adminPasswordOrKey\')]"}]}}}, "resources": [{"type": "Microsoft.Storage/storageAccounts", "name": "[parameters(\'newStorageAccountName\')]", "apiVersion": "2019-06-01", "location": "[parameters(\'location\')]", "sku": {"name": "[parameters(\'storageAccountType\')]"}, "kind": "StorageV2"}, {"apiVersion": "2020-05-01", "type": "Microsoft.Network/publicIPAddresses", "name": "[parameters(\'publicIPName\')]", "location": "[parameters(\'location\')]", "properties": {"publicIPAllocationMethod": "[parameters(\'publicIPAddressType\')]"}}, {"apiVersion": "2020-05-01", "type": "Microsoft.Network/networkInterfaces", "name": "[parameters(\'nicName\')]", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Network/publicIPAddresses/\', parameters(\'publicIPName\'))]"], "properties": {"ipConfigurations": [{"name": "ipconfig1", "properties": {"privateIPAllocationMethod": "Dynamic", "publicIPAddress": {"id": "[resourceId(\'Microsoft.Network/publicIPAddresses\', parameters(\'publicIPName\'))]"}, "subnet": {"id": "[resourceId(parameters(\'virtualNetworkResourceGroup\'), \'Microsoft.Network/virtualNetworks/subnets\', parameters(\'virtualNetworkName\'), parameters(\'subnet1Name\'))]"}}}]}}, {"apiVersion": "2020-06-01", "type": "Microsoft.Compute/virtualMachines", "name": "[parameters(\'vmName\')]", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Storage/storageAccounts/\', parameters(\'newStorageAccountName\'))]", "[resourceId(\'Microsoft.Network/networkInterfaces/\', parameters(\'nicName\'))]"], "properties": {"hardwareProfile": {"vmSize": "[parameters(\'vmSize\')]"}, "osProfile": {"computerName": "[parameters(\'vmName\')]", "adminUsername": "[parameters(\'adminUsername\')]", "adminPassword": "[parameters(\'adminPasswordOrKey\')]", "linuxConfiguration": "[if(equals(parameters(\'authenticationType\'), \'password\'), json(\'null\'), variables(\'linuxConfiguration\'))]"}, "storageProfile": {"imageReference": {"publisher": "[parameters(\'imagePublisher\')]", "offer": "[parameters(\'imageOffer\')]", "sku": "[parameters(\'imageSKU\')]", "version": "latest"}, "osDisk": {"name": "[concat(parameters(\'vmName\'),\'_OSDisk\')]", "caching": "ReadWrite", "createOption": "FromImage", "managedDisk": {"storageAccountType": "StandardSSD_LRS"}}}, "networkProfile": {"networkInterfaces": [{"id": "[resourceId(\'Microsoft.Network/networkInterfaces\', parameters(\'nicName\'))]"}]}, "diagnosticsProfile": {"bootDiagnostics": {"enabled": true, "storageUri": "[reference(resourceId(\'Microsoft.Storage/storageAccounts\', toLower(parameters(\'newStorageAccountName\')))).primaryEndpoints.blob]"}}}}]}


cli_script
Below is the equivalent Azure CLI script for the provided ARM template and parameters:\n\n```bash\n#!/bin/bash\n\n# Parameters\nnewStorageAccountName="zytest"\nstorageAccountType="Standard_LRS"\npublicIPName="zytest"\npublicIPAddressType="Dynamic"\nvmName="zytest"\nvmSize="Standard_A1_v2"\nimagePublisher="Canonical"\nimageOffer="UbuntuServer"\nimageSKU="18.04-LTS"\nadminUsername="zytest"\nvirtualNetworkName="zytest"\nvirtualNetworkResourceGroup="zytest"\nsubnet1Name="zytest"\nnicName="zytest"\nlocation="westus"\nauthenticationType="sshPublicKey"\nadminPasswordOrKey="zytest"\n\n# Create Storage Account\naz storage account create \\\n    --name $newStorageAccountName \\\n    --location $location \\\n    --sku $storageAccountType \\\n    --kind StorageV2\n\n# Create Public IP Address\naz network public-ip create \\\n    --name $publicIPName \\\n    --location $location \\\n    --allocation-method $publicIPAddressType\n\n# Create Network Interface\npublicIPAddressId=$(az network public-ip show --name $publicIPName --query "id" -o tsv)\nsubnetId=$(az network vnet subnet show --resource-group $virtualNetworkResourceGroup --vnet-name $virtualNetworkName --name $subnet1Name --query "id" -o tsv)\n\naz network nic create \\\n    --name $nicName \\\n    --location $location \\\n    --public-ip-address $publicIPAddressId \\\n    --subnet $subnetId\n\n# Create Virtual Machine\nsshPath="/home/$adminUsername/.ssh/authorized_keys"\nsshKeyData=$adminPasswordOrKey\nnicId=$(az network nic show --name $nicName --query "id" -o tsv)\n\naz vm create \\\n    --name $vmName \\\n    --location $location \\\n    --size $vmSize \\\n    --image $imagePublisher:$imageOffer:$imageSKU:latest \\\n    --admin-username $adminUsername \\\n    --authentication-type $authenticationType \\\n    --ssh-key-values $sshKeyData \\\n    --nics $nicId \\\n    --storage-sku StandardSSD_LRS\n\n# Note: The diagnostics storage account URI is not set in the CLI command as it is automatically configured by Azure when enabling boot diagnostics.\n```\n\nThis script assumes that all the required resources (like the VNet and Subnet) are already present and only the resources defined in the ARM template are to be created. If the VNet and Subnet need to be created, additional CLI commands should be added to the script. The `adminPasswordOrKey` is used directly as the SSH key, as per the default value and the `authenticationType` in the provided parameters. Adjust the `adminPasswordOrKey` variable if an actual SSH public key or password is to be used.


verify_result
