arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"virtualMachineName": {"type": "string", "metadata": {"description": "SQL Server Virtual Machine Name"}, "defaultValue": "zytest"}, "virtualMachineSize": {"type": "string", "metadata": {"description": "SQL Server Virtual Machine Size"}, "defaultValue": "Standard_D2s_v3"}, "adminUsername": {"type": "string", "metadata": {"description": "SQL Server Virtual Machine Administrator User Name"}, "defaultValue": "zytest"}, "adminPassword": {"type": "securestring", "metadata": {"description": "SQL Server Virtual Machine Administrator Password"}, "defaultValue": "zytest"}, "storageAccountName": {"type": "string", "metadata": {"description": "SQL Server Virtual Machine Storage Account Name"}, "defaultValue": "zytest"}, "storageAccountType": {"type": "string", "metadata": {"description": "SQL Server Virtual Machine Storage Account Type"}, "allowedValues": ["Premium_LRS", "Standard_LRS"], "defaultValue": "Premium_LRS"}, "virtualNetworkName": {"type": "string", "metadata": {"description": "SQL Server Virtual Machine Virtual Network Name"}, "defaultValue": "zytest"}, "networkInterfaceName": {"type": "string", "metadata": {"description": "SQL Server Virtual Machine Network Interface Name"}, "defaultValue": "zytest"}, "networkSecurityGroupName": {"type": "string", "metadata": {"description": "SQL Server Virtual Machine Network Security Group Name"}, "defaultValue": "zytest"}, "addressPrefix": {"type": "string", "metadata": {"description": "SQL Server Virtual Machine Subnet Name"}, "defaultValue": "10.0.0.0/16"}, "subnetName": {"type": "string", "metadata": {"description": "SQL Server Virtual Machine Subnet Name"}, "defaultValue": "default"}, "subnetPrefix": {"type": "string", "metadata": {"description": "SQL Server Virtual Machine Subnet Name"}, "defaultValue": "10.0.0.0/24"}, "publicIpAddressName": {"type": "string", "metadata": {"description": "SQL Server Virtual Machine Public IP Address Name"}, "defaultValue": "zytest"}, "publicIpAddressType": {"type": "string", "metadata": {"description": "SQL Server Virtual Machine Public IP Address Type"}, "defaultValue": "Dynamic"}, "sqlAutobackupStorageAccountName": {"type": "string", "metadata": {"description": "SQL Server Auto Backup Storage Account Name"}, "defaultValue": "zytest"}, "location": {"type": "string", "defaultValue": "westus", "metadata": {"description": "Location for all resources."}}}, "variables": {"subnetRef": "[resourceId(\'Microsoft.Network/virtualNetworks/subnets\', parameters(\'virtualNetworkName\'),  parameters(\'subnetName\'))]"}, "resources": [{"name": "[parameters(\'virtualMachineName\')]", "type": "Microsoft.Compute/virtualMachines", "apiVersion": "2021-07-01", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Network/networkInterfaces/\', parameters(\'networkInterfaceName\'))]", "[resourceId(\'Microsoft.Storage/storageAccounts/\', parameters(\'storageAccountName\'))]"], "properties": {"osProfile": {"computerName": "[parameters(\'virtualMachineName\')]", "adminUsername": "[parameters(\'adminUsername\')]", "adminPassword": "[parameters(\'adminPassword\')]", "windowsConfiguration": {"provisionVmAgent": "true"}}, "hardwareProfile": {"vmSize": "[parameters(\'virtualMachineSize\')]"}, "storageProfile": {"imageReference": {"publisher": "MicrosoftSQLServer", "offer": "SQL2014SP2-WS2012R2", "sku": "Enterprise", "version": "latest"}, "osDisk": {"name": "[concat(parameters(\'virtualMachineName\'),\'_OSDisk\')]", "createOption": "FromImage"}, "dataDisks": [{"name": "[concat(parameters(\'virtualMachineName\'),\'_DataDisk1\')]", "createOption": "Empty", "lun": 0, "diskSizeGB": 1023, "caching": "ReadOnly"}, {"name": "[concat(parameters(\'virtualMachineName\'),\'_DataDisk2\')]", "createOption": "Empty", "lun": 1, "diskSizeGB": 1023, "caching": "ReadOnly"}]}, "networkProfile": {"networkInterfaces": [{"id": "[resourceId(\'Microsoft.Network/networkInterfaces\', parameters(\'networkInterfaceName\'))]"}]}}}, {"apiVersion": "2015-06-15", "type": "Microsoft.Compute/virtualMachines/extensions", "name": "[concat(parameters(\'virtualMachineName\'), \'/SqlIaasExtension\')]", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Compute/virtualMachines/\', parameters(\'virtualMachineName\'))]"], "properties": {"type": "SqlIaaSAgent", "publisher": "Microsoft.SqlServer.Management", "typeHandlerVersion": "1.2", "autoUpgradeMinorVersion": true, "settings": {"AutoTelemetrySettings": {"Region": "[parameters(\'location\')]"}, "AutoPatchingSettings": {"PatchCategory": "WindowsMandatoryUpdates", "Enable": true, "DayOfWeek": "Sunday", "MaintenanceWindowStartingHour": "2", "MaintenanceWindowDuration": "60"}, "KeyVaultCredentialSettings": {"Enable": false}, "ServerConfigurationsManagementSettings": {"SQLConnectivityUpdateSettings": {"ConnectivityType": "Private", "Port": "1433"}, "SQLWorkloadTypeUpdateSettings": {"SQLWorkloadType": "GENERAL"}, "SQLStorageUpdateSettings": {"DiskCount": "1", "NumberOfColumns": "1", "StartingDeviceID": "2", "DiskConfigurationType": "NEW"}, "AdditionalFeaturesServerConfigurations": {"IsRServicesEnabled": "false"}}}}}, {"name": "[parameters(\'storageAccountName\')]", "type": "Microsoft.Storage/storageAccounts", "apiVersion": "2015-06-15", "location": "[parameters(\'location\')]", "properties": {"accountType": "[parameters(\'storageAccountType\')]"}}, {"name": "[parameters(\'sqlAutobackupStorageAccountName\')]", "type": "Microsoft.Storage/storageAccounts", "apiVersion": "2015-06-15", "location": "[parameters(\'location\')]", "properties": {"accountType": "Standard_LRS"}}, {"name": "[parameters(\'virtualNetworkName\')]", "type": "Microsoft.Network/virtualNetworks", "apiVersion": "2015-06-15", "location": "[parameters(\'location\')]", "properties": {"addressSpace": {"addressPrefixes": ["[parameters(\'addressPrefix\')]"]}, "subnets": [{"name": "[parameters(\'subnetName\')]", "properties": {"addressPrefix": "[parameters(\'subnetPrefix\')]"}}]}}, {"name": "[parameters(\'networkInterfaceName\')]", "type": "Microsoft.Network/networkInterfaces", "apiVersion": "2015-06-15", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Network/virtualNetworks/\', parameters(\'virtualNetworkName\'))]", "[resourceId(\'Microsoft.Network/publicIpAddresses/\', parameters(\'publicIpAddressName\'))]", "[resourceId(\'Microsoft.Network/networkSecurityGroups/\', parameters(\'networkSecurityGroupName\'))]"], "properties": {"ipConfigurations": [{"name": "ipconfig1", "properties": {"subnet": {"id": "[variables(\'subnetRef\')]"}, "privateIPAllocationMethod": "Dynamic", "publicIpAddress": {"id": "[resourceId(\'Microsoft.Network/publicIpAddresses\', parameters(\'publicIpAddressName\'))]"}}}], "networkSecurityGroup": {"id": "[resourceId(\'Microsoft.Network/networkSecurityGroups\', parameters(\'networkSecurityGroupName\'))]"}}}, {"name": "[parameters(\'publicIpAddressName\')]", "type": "Microsoft.Network/publicIPAddresses", "apiVersion": "2015-06-15", "location": "[parameters(\'location\')]", "properties": {"publicIPAllocationMethod": "[parameters(\'publicIpAddressType\')]"}}, {"name": "[parameters(\'networkSecurityGroupName\')]", "type": "Microsoft.Network/networkSecurityGroups", "apiVersion": "2015-06-15", "location": "[parameters(\'location\')]", "properties": {"securityRules": [{"name": "default-allow-rdp", "properties": {"priority": 1000, "sourceAddressPrefix": "*", "protocol": "Tcp", "destinationPortRange": "3389", "access": "Allow", "direction": "inbound", "sourcePortRange": "*", "destinationAddressPrefix": "*"}}, {"name": "default-allow-sql", "properties": {"priority": 1500, "sourceAddressPrefix": "*", "protocol": "Tcp", "destinationPortRange": "1433", "access": "Allow", "direction": "inbound", "sourcePortRange": "*", "destinationAddressPrefix": "*"}}]}}], "outputs": {"vmName": {"type": "string", "value": "[parameters(\'virtualMachineName\')]"}, "sqlAutobackupStorageAccountName": {"type": "string", "value": "[parameters(\'sqlAutobackupStorageAccountName\')]"}}}


cli_script
Below is the translated Azure CLI bash script from the provided ARM template and parameters:\n\n```bash\n#!/bin/bash\n\n# Parameters\nvirtualMachineName="zytest"\nvirtualMachineSize="Standard_D2s_v3"\nadminUsername="zytest"\nadminPassword="zytest" # Note: In a real-world scenario, use a secure method to handle passwords\nstorageAccountName="zytest"\nstorageAccountType="Premium_LRS"\nvirtualNetworkName="zytest"\nnetworkInterfaceName="zytest"\nnetworkSecurityGroupName="zytest"\naddressPrefix="10.0.0.0/16"\nsubnetName="default"\nsubnetPrefix="10.0.0.0/24"\npublicIpAddressName="zytest"\npublicIpAddressType="Dynamic"\nsqlAutobackupStorageAccountName="zytest"\nlocation="westus"\n\n# Create a storage account for the virtual machine\naz storage account create \\\n    --name $storageAccountName \\\n    --location $location \\\n    --sku $storageAccountType\n\n# Create a storage account for SQL auto backup\naz storage account create \\\n    --name $sqlAutobackupStorageAccountName \\\n    --location $location \\\n    --sku Standard_LRS\n\n# Create a virtual network\naz network vnet create \\\n    --name $virtualNetworkName \\\n    --location $location \\\n    --address-prefix $addressPrefix \\\n    --subnet-name $subnetName \\\n    --subnet-prefix $subnetPrefix\n\n# Create a public IP address\naz network public-ip create \\\n    --name $publicIpAddressName \\\n    --location $location \\\n    --allocation-method $publicIpAddressType\n\n# Create a network security group\naz network nsg create \\\n    --name $networkSecurityGroupName \\\n    --location $location\n\n# Add security rule for RDP\naz network nsg rule create \\\n    --nsg-name $networkSecurityGroupName \\\n    --name default-allow-rdp \\\n    --priority 1000 \\\n    --source-address-prefixes \'*\' \\\n    --destination-port-ranges 3389 \\\n    --access Allow \\\n    --direction Inbound \\\n    --protocol Tcp\n\n# Add security rule for SQL\naz network nsg rule create \\\n    --nsg-name $networkSecurityGroupName \\\n    --name default-allow-sql \\\n    --priority 1500 \\\n    --source-address-prefixes \'*\' \\\n    --destination-port-ranges 1433 \\\n    --access Allow \\\n    --direction Inbound \\\n    --protocol Tcp\n\n# Create a network interface\nsubnetId=$(az network vnet subnet show --vnet-name $virtualNetworkName --name $subnetName --query id --output tsv)\npublicIpId=$(az network public-ip show --name $publicIpAddressName --query id --output tsv)\nnsgId=$(az network nsg show --name $networkSecurityGroupName --query id --output tsv)\n\naz network nic create \\\n    --name $networkInterfaceName \\\n    --location $location \\\n    --subnet $subnetId \\\n    --public-ip-address $publicIpId \\\n    --network-security-group $nsgId\n\n# Create a virtual machine\nnicId=$(az network nic show --name $networkInterfaceName --query id --output tsv)\n\naz vm create \\\n    --name $virtualMachineName \\\n    --location $location \\\n    --nics $nicId \\\n    --image "MicrosoftSQLServer:SQL2014SP2-WS2012R2:Enterprise:latest" \\\n    --admin-username $adminUsername \\\n    --admin-password $adminPassword \\\n    --size $virtualMachineSize \\\n    --os-disk-name "${virtualMachineName}_OSDisk" \\\n    --storage-sku $storageAccountType\n\n# Create and attach data disks to the virtual machine\naz vm disk attach \\\n    --vm-name $virtualMachineName \\\n    --name "${virtualMachineName}_DataDisk1" \\\n    --new \\\n    --size-gb 1023 \\\n    --sku $storageAccountType \\\n    --lun 0 \\\n    --caching ReadOnly\n\naz vm disk attach \\\n    --vm-name $virtualMachineName \\\n    --name "${virtualMachineName}_DataDisk2" \\\n    --new \\\n    --size-gb 1023 \\\n    --sku $storageAccountType \\\n    --lun 1 \\\n    --caching ReadOnly\n\n# Add SQL IaaS Extension to the virtual machine\naz vm extension set \\\n    --vm-name $virtualMachineName \\\n    --name SqlIaasExtension \\\n    --publisher Microsoft.SqlServer.Management \\\n    --version 1.2 \\\n    --settings \'{"AutoTelemetrySettings":{"Region":"\'"$location"\'"},"AutoPatchingSettings":{"PatchCategory":"WindowsMandatoryUpdates","Enable":true,"DayOfWeek":"Sunday","MaintenanceWindowStartingHour":2,"MaintenanceWindowDuration":60},"KeyVaultCredentialSettings":{"Enable":false},"ServerConfigurationsManagementSettings":{"SQLConnectivityUpdateSettings":{"ConnectivityType":"Private","Port":"1433"},"SQLWorkloadTypeUpdateSettings":{"SQLWorkloadType":"GENERAL"},"SQLStorageUpdateSettings":{"DiskCount":1,"NumberOfColumns":1,"StartingDeviceID":2,"DiskConfigurationType":"NEW"},"AdditionalFeaturesServerConfigurations":{"IsRServicesEnabled":false}}}\' \\\n    --auto-upgrade-minor-version true\n\n# Output variables\necho "VM Name: $virtualMachineName"\necho "SQL Auto Backup Storage Account Name: $sqlAutobackupStorageAccountName"\n```\n\nPlease note that the above script assumes that you are already logged into Azure CLI with the necessary permissions to create these resources. Make sure to replace the adminPassword with a secure one or use a secure method to pass it to the script. The script does not include the creation of the SQL Server Auto Backup Storage Account since it was not defined in the resources section of the ARM template.


verify_result
