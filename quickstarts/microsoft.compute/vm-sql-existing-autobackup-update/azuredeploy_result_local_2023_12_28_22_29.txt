arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"existingVirtualMachineName": {"type": "string", "metadata": {"description": "Existing SQL Server virtual machine name"}, "defaultValue": "zytest"}, "sqlAutobackupRetentionPeriod": {"type": "string", "metadata": {"description": "SQL Server Auto Backup Retention Period"}, "allowedValues": ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30"], "defaultValue": "2"}, "sqlAutobackupStorageAccountName": {"type": "string", "metadata": {"description": "SQL Server Auto Backup Storage Account Name"}, "defaultValue": "zytest"}, "sqlAutobackupEncryptionPassword": {"type": "securestring", "metadata": {"description": "SQL Server Auto Backup Encryption Password"}, "defaultValue": "zytest"}, "location": {"type": "string", "defaultValue": "westus", "metadata": {"description": "Location for all resources."}}}, "resources": [{"apiVersion": "2021-07-01", "type": "Microsoft.Compute/virtualMachines/extensions", "name": "[concat(parameters(\'existingVirtualMachineName\'), \'/SqlIaasExtension\')]", "location": "[parameters(\'location\')]", "properties": {"type": "SqlIaaSAgent", "publisher": "Microsoft.SqlServer.Management", "typeHandlerVersion": "1.2", "autoUpgradeMinorVersion": true, "settings": {"AutoBackupSettings": {"Enable": true, "RetentionPeriod": "[parameters(\'sqlAutobackupRetentionPeriod\')]", "EnableEncryption": true}}, "protectedSettings": {"StorageUrl": "[reference(resourceId(\'Microsoft.Storage/storageAccounts\', parameters(\'sqlAutobackupStorageAccountName\')), \'2021-04-01\').primaryEndpoints[\'blob\']]", "StorageAccessKey": "[listKeys(resourceId(\'Microsoft.Storage/storageAccounts\', parameters(\'sqlAutobackupStorageAccountName\')), \'2021-04-01\').keys[0].value]", "Password": "[parameters(\'sqlAutobackupEncryptionPassword\')]"}}}], "outputs": {}}


cli_script
Based on the provided ARM template and parameters, here is the equivalent Azure CLI script in bash:\n\n```bash\n#!/bin/bash\n\n# Define the parameters as variables\nexistingVirtualMachineName="zytest"\nsqlAutobackupRetentionPeriod="2"\nsqlAutobackupStorageAccountName="zytest"\nsqlAutobackupEncryptionPassword="zytest"\nlocation="westus"\n\n# Get the primary blob endpoint of the storage account\nstorageAccountBlobEndpoint=$(az storage account show \\\n    --name $sqlAutobackupStorageAccountName \\\n    --query "primaryEndpoints.blob" \\\n    --output tsv)\n\n# Get the storage account access key\nstorageAccountAccessKey=$(az storage account keys list \\\n    --account-name $sqlAutobackupStorageAccountName \\\n    --query "[0].value" \\\n    --output tsv)\n\n# Deploy the SqlIaasExtension to the virtual machine\naz vm extension set \\\n    --name "SqlIaasExtension" \\\n    --publisher "Microsoft.SqlServer.Management" \\\n    --version "1.2" \\\n    --vm-name $existingVirtualMachineName \\\n    --resource-group $(az vm show --name $existingVirtualMachineName --query "resourceGroup" --output tsv) \\\n    --location $location \\\n    --settings "{\\"AutoBackupSettings\\":{\\"Enable\\":true,\\"RetentionPeriod\\":$sqlAutobackupRetentionPeriod,\\"EnableEncryption\\":true}}" \\\n    --protected-settings "{\\"StorageUrl\\":\\"$storageAccountBlobEndpoint\\",\\"StorageAccessKey\\":\\"$storageAccountAccessKey\\",\\"Password\\":\\"$sqlAutobackupEncryptionPassword\\"}"\n```\n\nPlease note that you need to have the Azure CLI installed and be logged in to your Azure account for this script to work. Also, the resource group for the virtual machine is derived from the VM\'s details, assuming the VM is in the same resource group as the extension. If the VM is in a different resource group, you will need to specify it directly.


verify_result
