arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "metadata": {"_generator": {"name": "bicep", "version": "0.5.6.12127", "templateHash": "13701565265914879608"}}, "parameters": {"virtualMachineSize": {"type": "string", "defaultValue": "Standard_DS1_v2", "metadata": {"description": "Virtual machine size (has to be at least the size of Standard_A3 to support 2 NICs)"}}, "adminUsername": {"type": "string", "metadata": {"description": "Default Admin username"}, "defaultValue": "zytest"}, "adminPassword": {"type": "secureString", "metadata": {"description": "Default Admin password"}, "defaultValue": "zytest"}, "storageAccountType": {"type": "string", "defaultValue": "Standard_LRS", "allowedValues": ["Standard_LRS", "Premium_LRS"], "metadata": {"description": "Storage Account type for the VM and VM diagnostic storage"}}, "location": {"type": "string", "defaultValue": "westus", "metadata": {"description": "Location for all resources."}}}, "variables": {"virtualMachineName": "VM-MultiNic", "nic1Name": "nic-1", "nic2Name": "nic-2", "virtualNetworkName": "virtualNetwork", "subnet1Name": "subnet-1", "subnet2Name": "subnet-2", "publicIPAddressName": "publicIp", "diagStorageAccountName": "[format(\'diags{0}\', uniqueString(resourceGroup().id))]", "networkSecurityGroupName": "NSG", "networkSecurityGroupName2": "[format(\'{0}-nsg\', variables(\'subnet2Name\'))]"}, "resources": [{"type": "Microsoft.Compute/virtualMachines", "apiVersion": "2020-06-01", "name": "[variables(\'virtualMachineName\')]", "location": "[parameters(\'location\')]", "properties": {"osProfile": {"computerName": "[variables(\'virtualMachineName\')]", "adminUsername": "[parameters(\'adminUsername\')]", "adminPassword": "[parameters(\'adminPassword\')]", "windowsConfiguration": {"provisionVMAgent": true}}, "hardwareProfile": {"vmSize": "[parameters(\'virtualMachineSize\')]"}, "storageProfile": {"imageReference": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "2019-Datacenter", "version": "latest"}, "osDisk": {"createOption": "FromImage"}}, "networkProfile": {"networkInterfaces": [{"properties": {"primary": true}, "id": "[resourceId(\'Microsoft.Network/networkInterfaces\', variables(\'nic1Name\'))]"}, {"properties": {"primary": false}, "id": "[resourceId(\'Microsoft.Network/networkInterfaces\', variables(\'nic2Name\'))]"}]}, "diagnosticsProfile": {"bootDiagnostics": {"enabled": true, "storageUri": "[reference(resourceId(\'Microsoft.Storage/storageAccounts\', variables(\'diagStorageAccountName\'))).primaryEndpoints.blob]"}}}, "dependsOn": ["[resourceId(\'Microsoft.Storage/storageAccounts\', variables(\'diagStorageAccountName\'))]", "[resourceId(\'Microsoft.Network/networkInterfaces\', variables(\'nic1Name\'))]", "[resourceId(\'Microsoft.Network/networkInterfaces\', variables(\'nic2Name\'))]"]}, {"type": "Microsoft.Storage/storageAccounts", "apiVersion": "2019-06-01", "name": "[variables(\'diagStorageAccountName\')]", "location": "[parameters(\'location\')]", "sku": {"name": "[parameters(\'storageAccountType\')]"}, "kind": "StorageV2"}, {"type": "Microsoft.Network/networkSecurityGroups", "apiVersion": "2020-06-01", "name": "[variables(\'networkSecurityGroupName2\')]", "location": "[parameters(\'location\')]"}, {"type": "Microsoft.Network/virtualNetworks", "apiVersion": "2020-06-01", "name": "[variables(\'virtualNetworkName\')]", "location": "[parameters(\'location\')]", "properties": {"addressSpace": {"addressPrefixes": ["10.0.0.0/16"]}, "subnets": [{"name": "[variables(\'subnet1Name\')]", "properties": {"addressPrefix": "10.0.0.0/24"}}, {"name": "[variables(\'subnet2Name\')]", "properties": {"addressPrefix": "10.0.1.0/24", "networkSecurityGroup": {"id": "[resourceId(\'Microsoft.Network/networkSecurityGroups\', variables(\'networkSecurityGroupName2\'))]"}}}]}, "dependsOn": ["[resourceId(\'Microsoft.Network/networkSecurityGroups\', variables(\'networkSecurityGroupName2\'))]"]}, {"type": "Microsoft.Network/networkInterfaces", "apiVersion": "2020-06-01", "name": "[variables(\'nic1Name\')]", "location": "[parameters(\'location\')]", "properties": {"ipConfigurations": [{"name": "ipconfig1", "properties": {"subnet": {"id": "[resourceId(\'Microsoft.Network/virtualNetworks/subnets\', variables(\'virtualNetworkName\'), variables(\'subnet1Name\'))]"}, "privateIPAllocationMethod": "Dynamic", "publicIPAddress": {"id": "[resourceId(\'Microsoft.Network/publicIPAddresses\', variables(\'publicIPAddressName\'))]"}}}], "networkSecurityGroup": {"id": "[resourceId(\'Microsoft.Network/networkSecurityGroups\', variables(\'networkSecurityGroupName\'))]"}}, "dependsOn": ["[resourceId(\'Microsoft.Network/networkSecurityGroups\', variables(\'networkSecurityGroupName\'))]", "[resourceId(\'Microsoft.Network/publicIPAddresses\', variables(\'publicIPAddressName\'))]", "[resourceId(\'Microsoft.Network/virtualNetworks\', variables(\'virtualNetworkName\'))]"]}, {"type": "Microsoft.Network/networkInterfaces", "apiVersion": "2020-06-01", "name": "[variables(\'nic2Name\')]", "location": "[parameters(\'location\')]", "properties": {"ipConfigurations": [{"name": "ipconfig1", "properties": {"subnet": {"id": "[resourceId(\'Microsoft.Network/virtualNetworks/subnets\', variables(\'virtualNetworkName\'), variables(\'subnet2Name\'))]"}, "privateIPAllocationMethod": "Dynamic"}}]}, "dependsOn": ["[resourceId(\'Microsoft.Network/virtualNetworks\', variables(\'virtualNetworkName\'))]"]}, {"type": "Microsoft.Network/publicIPAddresses", "apiVersion": "2020-06-01", "name": "[variables(\'publicIPAddressName\')]", "location": "[parameters(\'location\')]", "properties": {"publicIPAllocationMethod": "Dynamic"}}, {"type": "Microsoft.Network/networkSecurityGroups", "apiVersion": "2020-06-01", "name": "[variables(\'networkSecurityGroupName\')]", "location": "[parameters(\'location\')]", "properties": {"securityRules": [{"name": "default-allow-rdp", "properties": {"priority": 1000, "sourceAddressPrefix": "*", "protocol": "Tcp", "destinationPortRange": "3389", "access": "Allow", "direction": "Inbound", "sourcePortRange": "*", "destinationAddressPrefix": "*"}}]}}]}


cli_script
Here is the equivalent CLI script:\n\n```bash\n#!/bin/bash\n\n# Define parameters\nvirtualMachineSize="Standard_DS1_v2"\nadminUsername="zytest"\nadminPassword="zytest"\nstorageAccountType="Standard_LRS"\nlocation="westus"\n\n# Define variables\nvirtualMachineName="VM-MultiNic"\nnic1Name="nic-1"\nnic2Name="nic-2"\nvirtualNetworkName="virtualNetwork"\nsubnet1Name="subnet-1"\nsubnet2Name="subnet-2"\npublicIPAddressName="publicIp"\nnetworkSecurityGroupName="NSG"\nnetworkSecurityGroupName2="${subnet2Name}-nsg"\n\n# Create resources\naz group create --name myResourceGroup --location $location\n\naz storage account create --name $diagStorageAccountName --location $location --resource-group myResourceGroup --sku $storageAccountType --kind StorageV2\n\naz network nsg create --name $networkSecurityGroupName2 --resource-group myResourceGroup --location $location\n\naz network vnet create --name $virtualNetworkName --resource-group myResourceGroup --location $location --address-prefix 10.0.0.0/16 --subnet-name $subnet1Name --subnet-prefix 10.0.0.0/24\n\naz network vnet subnet create --name $subnet2Name --resource-group myResourceGroup --vnet-name $virtualNetworkName --address-prefix 10.0.1.0/24 --network-security-group $networkSecurityGroupName2\n\naz network nic create --name $nic1Name --resource-group myResourceGroup --location $location --subnet $subnet1Name --vnet-name $virtualNetworkName --public-ip-address $publicIPAddressName --network-security-group $networkSecurityGroupName\n\naz network nic create --name $nic2Name --resource-group myResourceGroup --location $location --subnet $subnet2Name --vnet-name $virtualNetworkName\n\naz network public-ip create --name $publicIPAddressName --resource-group myResourceGroup --location $location --allocation-method Dynamic\n\naz network nsg create --name $networkSecurityGroupName --resource-group myResourceGroup --location $location\n\naz network nsg rule create --name default-allow-rdp --nsg-name $networkSecurityGroupName --resource-group myResourceGroup --priority 1000 --source-address-prefixes \'*\' --destination-port-ranges 3389 --access Allow --protocol Tcp --direction Inbound\n\naz vm create --name $virtualMachineName --resource-group myResourceGroup --location $location --nics $nic1Name $nic2Name --admin-username $adminUsername --admin-password $adminPassword --size $virtualMachineSize --image MicrosoftWindowsServer:WindowsServer:2019-Datacenter:latest --storage-sku $storageAccountType --os-disk-name $virtualMachineName\n```\n\nPlease replace `myResourceGroup` with your actual resource group name. Also, the `diagStorageAccountName` is generated by a function in the original ARM template, you need to replace it with a unique name in the script.


verify_result
