arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"adminUsername": {"type": "string", "metadata": {"description": "User name for the Virtual Machine."}, "defaultValue": "zytest"}, "adminPassword": {"type": "securestring", "metadata": {"description": "Password for the Virtual Machine."}, "defaultValue": "zytest"}, "vmSize": {"type": "string", "metadata": {"description": "Size of the virtual machine"}, "defaultValue": "Standard_A1_v2"}, "keyVaultName": {"type": "string", "metadata": {"description": "Name of the KeyVault to place the volume encryption key"}, "defaultValue": "zytest"}, "keyVaultResourceGroup": {"type": "string", "metadata": {"description": "Resource group of the KeyVault"}, "defaultValue": "zytest"}, "keyEncryptionKeyURL": {"type": "string", "defaultValue": "", "metadata": {"description": "URL of the KeyEncryptionKey used to encrypt the volume encryption key"}}, "location": {"type": "string", "defaultValue": "westus", "metadata": {"description": "Location for all resources."}}}, "variables": {"nicName": "myVMNic", "subnetName": "Subnet", "vmName": "MyWindowsVM", "virtualNetworkName": "MyVNET", "subnetRef": "[resourceId(\'Microsoft.Network/virtualNetworks/subnets/\', variables(\'virtualNetworkName\'), variables(\'subnetName\'))]", "extensionName": "AzureDiskEncryption", "extensionVersion": "2.2", "encryptionOperation": "EnableEncryption", "keyEncryptionAlgorithm": "RSA-OAEP", "keyVaultResourceID": "[resourceId(parameters(\'keyVaultResourceGroup\'), \'Microsoft.KeyVault/vaults/\', parameters(\'keyVaultName\'))]"}, "resources": [{"apiVersion": "2020-05-01", "type": "Microsoft.Network/virtualNetworks", "name": "[variables(\'virtualNetworkName\')]", "location": "[parameters(\'location\')]", "properties": {"addressSpace": {"addressPrefixes": ["10.0.0.0/16"]}, "subnets": [{"name": "[variables(\'subnetName\')]", "properties": {"addressPrefix": "10.0.0.0/24"}}]}}, {"apiVersion": "2020-05-01", "type": "Microsoft.Network/networkInterfaces", "name": "[variables(\'nicName\')]", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Network/virtualNetworks/\', variables(\'virtualNetworkName\'))]"], "properties": {"ipConfigurations": [{"name": "ipconfig1", "properties": {"privateIPAllocationMethod": "Dynamic", "subnet": {"id": "[variables(\'subnetRef\')]"}}}]}}, {"apiVersion": "2019-12-01", "type": "Microsoft.Compute/virtualMachines", "name": "[variables(\'vmName\')]", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Network/networkInterfaces/\', variables(\'nicName\'))]"], "properties": {"hardwareProfile": {"vmSize": "[parameters(\'vmSize\')]"}, "osProfile": {"computerName": "[variables(\'vmName\')]", "adminUsername": "[parameters(\'adminUsername\')]", "adminPassword": "[parameters(\'adminPassword\')]"}, "storageProfile": {"imageReference": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "2019-Datacenter", "version": "latest"}, "osDisk": {"createOption": "FromImage"}, "dataDisks": [{"diskSizeGB": "1023", "lun": 0, "createOption": "Empty"}]}, "networkProfile": {"networkInterfaces": [{"id": "[resourceId(\'Microsoft.Network/networkInterfaces\',variables(\'nicName\'))]"}]}}}, {"type": "Microsoft.Compute/virtualMachines/extensions", "name": "[concat(variables(\'vmName\'),\'/\', variables(\'extensionName\'))]", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Compute/virtualMachines/\', variables(\'vmName\'))]"], "apiVersion": "2019-12-01", "properties": {"publisher": "Microsoft.Azure.Security", "type": "[variables(\'extensionName\')]", "typeHandlerVersion": "[variables(\'extensionVersion\')]", "autoUpgradeMinorVersion": true, "forceUpdateTag": "1.0", "settings": {"EncryptionOperation": "[variables(\'encryptionOperation\')]", "KeyVaultURL": "[reference(variables(\'keyVaultResourceId\'),\'2018-02-14-preview\').vaultUri]", "KeyVaultResourceId": "[variables(\'keyVaultResourceID\')]", "KeyEncryptionKeyURL": "[parameters(\'keyEncryptionKeyURL\')]", "KekVaultResourceId": "[variables(\'keyVaultResourceID\')]", "KeyEncryptionAlgorithm": "[variables(\'keyEncryptionAlgorithm\')]", "VolumeType": "All", "ResizeOSDisk": false}}}], "outputs": {"vmName": {"type": "string", "value": "[variables(\'vmName\')]"}}}


cli_script
Based on the provided ARM template and template parameters, the following bash script translates the ARM template into Azure CLI commands:\n\n```bash\n#!/bin/bash\n\n# Template parameters\nadminUsername="zytest"\nadminPassword="zytest"\nvmSize="Standard_A1_v2"\nkeyVaultName="zytest"\nkeyVaultResourceGroup="zytest"\nkeyEncryptionKeyURL=""\nlocation="westus"\n\n# Variables\nnicName="myVMNic"\nsubnetName="Subnet"\nvmName="MyWindowsVM"\nvirtualNetworkName="MyVNET"\nsubnetRef=$(az network vnet subnet show --name "$subnetName" --vnet-name "$virtualNetworkName" --query id --output tsv)\nextensionName="AzureDiskEncryption"\nextensionVersion="2.2"\nencryptionOperation="EnableEncryption"\nkeyEncryptionAlgorithm="RSA-OAEP"\nkeyVaultResourceID=$(az keyvault show --name "$keyVaultName" --resource-group "$keyVaultResourceGroup" --query id --output tsv)\n\n# Create Virtual Network\naz network vnet create \\\n    --name "$virtualNetworkName" \\\n    --resource-group "$keyVaultResourceGroup" \\\n    --location "$location" \\\n    --address-prefixes "10.0.0.0/16" \\\n    --subnet-name "$subnetName" \\\n    --subnet-prefix "10.0.0.0/24"\n\n# Create Network Interface\naz network nic create \\\n    --name "$nicName" \\\n    --resource-group "$keyVaultResourceGroup" \\\n    --location "$location" \\\n    --subnet "$subnetRef"\n\n# Create Virtual Machine\naz vm create \\\n    --name "$vmName" \\\n    --resource-group "$keyVaultResourceGroup" \\\n    --location "$location" \\\n    --nics "$nicName" \\\n    --size "$vmSize" \\\n    --admin-username "$adminUsername" \\\n    --admin-password "$adminPassword" \\\n    --image "MicrosoftWindowsServer:WindowsServer:2019-Datacenter:latest" \\\n    --os-disk-size-gb "1023" \\\n    --data-disk-sizes-gb "1023"\n\n# Add Disk Encryption Extension\naz vm extension set \\\n    --resource-group "$keyVaultResourceGroup" \\\n    --vm-name "$vmName" \\\n    --name "$extensionName" \\\n    --publisher "Microsoft.Azure.Security" \\\n    --version "$extensionVersion" \\\n    --settings "{\\"EncryptionOperation\\":\\"$encryptionOperation\\", \\"KeyVaultURL\\":\\"$(az keyvault show --name "$keyVaultName" --query "properties.vaultUri" --output tsv)\\", \\"KeyVaultResourceId\\":\\"$keyVaultResourceID\\", \\"KeyEncryptionKeyURL\\":\\"$keyEncryptionKeyURL\\", \\"KekVaultResourceId\\":\\"$keyVaultResourceID\\", \\"KeyEncryptionAlgorithm\\":\\"$keyEncryptionAlgorithm\\", \\"VolumeType\\":\\"All\\", \\"ResizeOSDisk\\":false}"\n\n# Output the VM name\necho "VM Name: $vmName"\n```\n\nPlease note that this script assumes that the Key Vault and Virtual Network already exist in the specified resource group, and the subnet is already part of the virtual network. If this is not the case, additional CLI commands would be required to create those resources. Additionally, the script assumes that the user has the necessary permissions to create these resources in Azure.\n\nBefore running the script, make sure you are logged in to your Azure account using the Azure CLI with `az login`. Also, replace the resource group name in the `--resource-group` parameters with the actual resource group you intend to use if it\'s different from the default values.


verify_result
