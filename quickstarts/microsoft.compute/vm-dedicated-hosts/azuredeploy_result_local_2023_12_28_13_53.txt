arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"location": {"type": "string", "defaultValue": "westus", "metadata": {"description": "Location for the resources."}}, "numberOfZoness": {"type": "int", "defaultValue": 0, "metadata": {"description": "How many Zone to use. Use 0 for non zonal deployment."}}, "numberofHostsPerZone": {"type": "int", "defaultValue": 2, "metadata": {"description": "How many hosts to create per zone."}}, "numberOfFDs": {"type": "int", "defaultValue": 2, "metadata": {"description": "How many fault domains to use. "}}, "dhgNamePrefix": {"type": "string", "defaultValue": "myHostGroup", "metadata": {"description": "Name (prefix) for your host group."}}, "dhNamePrefix": {"type": "string", "defaultValue": "myHost", "metadata": {"description": "Name (prefix) for your host ."}}, "dhSKU": {"type": "string", "defaultValue": "DSv3-Type1", "metadata": {"description": "The type (family and generation) for your host ."}}}, "variables": {"numberOfHosts": "[if(equals(parameters(\'numberOfZoness\'), 0), parameters(\'numberofHostsPerZone\'), mul(parameters(\'numberOfZoness\'), parameters(\'numberofHostsPerZone\')))]"}, "resources": [{"name": "[concat(parameters(\'dhgNamePrefix\'),copyIndex())]", "type": "Microsoft.Compute/HostGroups", "apiVersion": "2020-12-01", "location": "[parameters(\'location\')]", "zones": "[if(equals(parameters(\'numberOfZoness\'), 0), json(\'null\'),array(copyindex(1)))]", "copy": {"name": "[parameters(\'dhgNamePrefix\')]", "count": "[if(equals(parameters(\'numberOfZoness\'), 0), 1, parameters(\'numberOfZoness\'))]"}, "properties": {"platformFaultDomainCount": "[parameters(\'numberOfFDs\')]"}}, {"name": "[concat(parameters(\'dhgNamePrefix\'),div(copyindex(), parameters(\'numberofHostsPerZone\')),\'/\', parameters(\'dhNamePrefix\'),div(copyindex(), parameters(\'numberofHostsPerZone\')),mod(copyindex(), parameters(\'numberofHostsPerZone\')))]", "type": "Microsoft.Compute/Hostgroups/hosts", "apiVersion": "2018-10-01", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Compute/hostGroups\',parameters(\'dhgNamePrefix\'), copyindex(2))]"], "sku": {"name": "[parameters(\'dhSKU\')]"}, "copy": {"name": "[parameters(\'dhgNamePrefix\')]", "count": "[variables(\'numberOfHosts\')]"}, "properties": {"platformFaultDomain": "[mod(copyindex(), parameters(\'numberOfFDs\'))]"}}], "outputs": {"hostCount": {"type": "int", "value": "[variables(\'numberOfHosts\')]"}}}


cli_script
Based on the provided ARM template and template parameters, below is the equivalent Azure CLI script that can be executed in a bash environment:\n\n```bash\n#!/bin/bash\n\n# Assign the parameter values to variables\nlocation="westus" # Location for the resources.\nnumberOfZoness=0 # How many Zone to use. Use 0 for non zonal deployment.\nnumberofHostsPerZone=2 # How many hosts to create per zone.\nnumberOfFDs=2 # How many fault domains to use.\ndhgNamePrefix="myHostGroup" # Name (prefix) for your host group.\ndhNamePrefix="myHost" # Name (prefix) for your host.\ndhSKU="DSv3-Type1" # The type (family and generation) for your host.\n\n# Calculate the number of hosts\nif [ "$numberOfZoness" -eq 0 ]; then\n  numberOfHosts=$numberofHostsPerZone\nelse\n  numberOfHosts=$((numberOfZoness * numberofHostsPerZone))\nfi\n\n# Create Host Groups\nfor ((i=0; i<${numberOfZoness}; i++)); do\n  # If numberOfZoness is 0, this loop will not execute\n  zones=$(($i + 1))\n  az compute host group create \\\n    --name "${dhgNamePrefix}${i}" \\\n    --resource-group "<YourResourceGroupName>" \\\n    --location "$location" \\\n    --platform-fault-domain-count "$numberOfFDs" \\\n    --zone "$zones"\ndone\n\n# If numberOfZoness is 0, create a single non-zonal host group\nif [ "$numberOfZoness" -eq 0 ]; then\n  az compute host group create \\\n    --name "${dhgNamePrefix}0" \\\n    --resource-group "<YourResourceGroupName>" \\\n    --location "$location" \\\n    --platform-fault-domain-count "$numberOfFDs"\nfi\n\n# Create Hosts within the Host Groups\nfor ((i=0; i<${numberOfHosts}; i++)); do\n  hostGroupName=$(($i / $numberofHostsPerZone))\n  hostName=$(($i / $numberofHostsPerZone))\n  platformFaultDomain=$(($i % $numberOfFDs))\n  az compute host create \\\n    --host-group "${dhgNamePrefix}${hostGroupName}" \\\n    --name "${dhNamePrefix}${hostName}${platformFaultDomain}" \\\n    --resource-group "<YourResourceGroupName>" \\\n    --location "$location" \\\n    --platform-fault-domain "$platformFaultDomain" \\\n    --sku "$dhSKU"\ndone\n\n# Output the number of hosts created\necho "Number of hosts created: $numberOfHosts"\n```\n\nPlease note the following:\n- Replace `<YourResourceGroupName>` with the actual name of your Azure resource group.\n- The ARM template assumes that the `copy` function and `dependsOn` are used, which are not available in Azure CLI. Therefore, the script above uses loops to create the necessary resources.\n- The script assumes that the host group and host names are based on the index of the loop iteration.\n- The script calculates the number of hosts based on the parameters provided and creates the resources accordingly.\n- The script assumes that the `zones` parameter should be set if `numberOfZoness` is greater than 0; otherwise, it is not set for a non-zonal deployment.\n- The script outputs the number of hosts created at the end of execution.


verify_result
