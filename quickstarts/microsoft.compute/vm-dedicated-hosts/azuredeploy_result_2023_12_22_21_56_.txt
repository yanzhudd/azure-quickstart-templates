arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"location": {"type": "string", "defaultValue": "westus", "metadata": {"description": "Location for the resources."}}, "numberOfZoness": {"type": "int", "defaultValue": 0, "metadata": {"description": "How many Zone to use. Use 0 for non zonal deployment."}}, "numberofHostsPerZone": {"type": "int", "defaultValue": 2, "metadata": {"description": "How many hosts to create per zone."}}, "numberOfFDs": {"type": "int", "defaultValue": 2, "metadata": {"description": "How many fault domains to use. "}}, "dhgNamePrefix": {"type": "string", "defaultValue": "myHostGroup", "metadata": {"description": "Name (prefix) for your host group."}}, "dhNamePrefix": {"type": "string", "defaultValue": "myHost", "metadata": {"description": "Name (prefix) for your host ."}}, "dhSKU": {"type": "string", "defaultValue": "DSv3-Type1", "metadata": {"description": "The type (family and generation) for your host ."}}}, "variables": {"numberOfHosts": "[if(equals(parameters(\'numberOfZoness\'), 0), parameters(\'numberofHostsPerZone\'), mul(parameters(\'numberOfZoness\'), parameters(\'numberofHostsPerZone\')))]"}, "resources": [{"name": "[concat(parameters(\'dhgNamePrefix\'),copyIndex())]", "type": "Microsoft.Compute/HostGroups", "apiVersion": "2020-12-01", "location": "[parameters(\'location\')]", "zones": "[if(equals(parameters(\'numberOfZoness\'), 0), json(\'null\'),array(copyindex(1)))]", "copy": {"name": "[parameters(\'dhgNamePrefix\')]", "count": "[if(equals(parameters(\'numberOfZoness\'), 0), 1, parameters(\'numberOfZoness\'))]"}, "properties": {"platformFaultDomainCount": "[parameters(\'numberOfFDs\')]"}}, {"name": "[concat(parameters(\'dhgNamePrefix\'),div(copyindex(), parameters(\'numberofHostsPerZone\')),\'/\', parameters(\'dhNamePrefix\'),div(copyindex(), parameters(\'numberofHostsPerZone\')),mod(copyindex(), parameters(\'numberofHostsPerZone\')))]", "type": "Microsoft.Compute/Hostgroups/hosts", "apiVersion": "2018-10-01", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Compute/hostGroups\',parameters(\'dhgNamePrefix\'), copyindex(2))]"], "sku": {"name": "[parameters(\'dhSKU\')]"}, "copy": {"name": "[parameters(\'dhgNamePrefix\')]", "count": "[variables(\'numberOfHosts\')]"}, "properties": {"platformFaultDomain": "[mod(copyindex(), parameters(\'numberOfFDs\'))]"}}], "outputs": {"hostCount": {"type": "int", "value": "[variables(\'numberOfHosts\')]"}}}


cli_script
Here is the equivalent CLI script:\n\n```bash\n#!/bin/bash\n\n# Define parameters\nlocation="westus"\nnumberOfZoness=0\nnumberofHostsPerZone=2\nnumberOfFDs=2\ndhgNamePrefix="myHostGroup"\ndhNamePrefix="myHost"\ndhSKU="DSv3-Type1"\n\n# Calculate the number of hosts\nif [ $numberOfZoness -eq 0 ]\nthen\n  numberOfHosts=$numberofHostsPerZone\nelse\n  numberOfHosts=$(($numberOfZoness*$numberofHostsPerZone))\nfi\n\n# Create host groups\nfor ((i=0; i<$numberOfZoness; i++))\ndo\n  az compute host group create --name $dhgNamePrefix$i --resource-group myResourceGroup --location $location --platform-fault-domain-count $numberOfFDs\ndone\n\n# Create hosts\nfor ((i=0; i<$numberOfHosts; i++))\ndo\n  hostGroupName=$dhgNamePrefix$(($i/$numberofHostsPerZone))\n  hostName=$dhNamePrefix$(($i/$numberofHostsPerZone))$(($i%$numberofHostsPerZone))\n  az compute host create --name $hostName --resource-group myResourceGroup --host-group $hostGroupName --location $location --sku $dhSKU --platform-fault-domain $(($i%$numberOfFDs))\ndone\n\n# Output the number of hosts\necho $numberOfHosts\n```\n\nPlease replace `myResourceGroup` with your actual resource group name.


verify_result
