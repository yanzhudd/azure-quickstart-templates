arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"existingVirtualMachineName": {"type": "string", "metadata": {"description": "Existing SQL Server virtual machine name"}, "defaultValue": "zytest"}, "sqlAutobackupRetentionPeriod": {"type": "string", "metadata": {"description": "SQL Server Auto Backup Retention Period"}, "allowedValues": ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30"], "defaultValue": "2"}, "sqlAutobackupStorageAccountName": {"type": "string", "metadata": {"description": "SQL Server Auto Backup Storage Account Name"}, "defaultValue": "zytest"}, "sqlAutobackupEncryptionPassword": {"type": "securestring", "metadata": {"description": "SQL Server Auto Backup Encryption Password"}, "defaultValue": "zytest"}, "location": {"type": "string", "defaultValue": "westus", "metadata": {"description": "Location for all resources."}}}, "resources": [{"apiVersion": "2021-07-01", "type": "Microsoft.Compute/virtualMachines/extensions", "name": "[concat(parameters(\'existingVirtualMachineName\'), \'/SqlIaasExtension\')]", "location": "[parameters(\'location\')]", "properties": {"type": "SqlIaaSAgent", "publisher": "Microsoft.SqlServer.Management", "typeHandlerVersion": "1.2", "autoUpgradeMinorVersion": true, "settings": {"AutoBackupSettings": {"Enable": true, "RetentionPeriod": "[parameters(\'sqlAutobackupRetentionPeriod\')]", "EnableEncryption": true}}, "protectedSettings": {"StorageUrl": "[reference(resourceId(\'Microsoft.Storage/storageAccounts\', parameters(\'sqlAutobackupStorageAccountName\')), \'2021-04-01\').primaryEndpoints[\'blob\']]", "StorageAccessKey": "[listKeys(resourceId(\'Microsoft.Storage/storageAccounts\', parameters(\'sqlAutobackupStorageAccountName\')), \'2021-04-01\').keys[0].value]", "Password": "[parameters(\'sqlAutobackupEncryptionPassword\')]"}}}], "outputs": {}}


cli_script
Based on the provided ARM template and parameters, here is the equivalent Azure CLI script translated into a bash script:\n\n```bash\n#!/bin/bash\n\n# Define variables from the template parameters\nexistingVirtualMachineName="zytest"\nsqlAutobackupRetentionPeriod="2"\nsqlAutobackupStorageAccountName="zytest"\nsqlAutobackupEncryptionPassword="zytest"\nlocation="westus"\n\n# Get the primary blob endpoint of the storage account\nstorageAccountBlobEndpoint=$(az storage account show --name $sqlAutobackupStorageAccountName --query "primaryEndpoints.blob" --output tsv)\n\n# Get the storage account access key\nstorageAccountAccessKey=$(az storage account keys list --account-name $sqlAutobackupStorageAccountName --query "[0].value" --output tsv)\n\n# Deploy the SQL IaaS Extension to the existing virtual machine\naz vm extension set \\\n  --resource-group "<your-resource-group>" \\\n  --vm-name $existingVirtualMachineName \\\n  --name "SqlIaasExtension" \\\n  --publisher "Microsoft.SqlServer.Management" \\\n  --version "1.2" \\\n  --settings "{\\"AutoBackupSettings\\":{\\"Enable\\":true,\\"RetentionPeriod\\":$sqlAutobackupRetentionPeriod,\\"EnableEncryption\\":true}}" \\\n  --protected-settings "{\\"StorageUrl\\":\\"$storageAccountBlobEndpoint\\",\\"StorageAccessKey\\":\\"$storageAccountAccessKey\\",\\"Password\\":\\"$sqlAutobackupEncryptionPassword\\"}" \\\n  --location $location\n\n# Note: Replace <your-resource-group> with the actual resource group name where the virtual machine is located.\n```\n\nThis script sets up the necessary variables based on the default values provided in the ARM template parameters. It then retrieves the storage account\'s primary blob endpoint and access key using the Azure CLI. Finally, it uses the `az vm extension set` command to add the SQL IaaS Extension to the specified virtual machine with the provided settings.\n\nMake sure to replace `<your-resource-group>` with the actual resource group name where your virtual machine is located before running the script.


verify_result
{"diff_info": ["  ", "  Thedeploymentwillupdatethefollowingscope:", "  ", "  Scope:/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg", "  ", "  -Microsoft.CognitiveServices/accounts/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.CognitiveServices/accounts/cli-translator\\"", "  identity.type:\\"None\\"", "  kind:\\"FormRecognizer\\"", "  location:\\"westus2\\"", "  name:\\"cli-translator\\"", "  sku.name:\\"F0\\"", "  type:\\"Microsoft.CognitiveServices/accounts\\"", "  ", "  -Microsoft.DocumentDb/databaseAccounts/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.DocumentDb/databaseAccounts/cli-translator\\"", "  identity.type:\\"None\\"", "  kind:\\"GlobalDocumentDB\\"", "  location:\\"westus\\"", "  name:\\"cli-translator\\"", "  tags.defaultExperience:\\"Core(SQL)\\"", "  type:\\"Microsoft.DocumentDb/databaseAccounts\\"", "  ", "  -Microsoft.Search/searchServices/customdatasearch", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Search/searchServices/customdatasearch\\"", "  location:\\"westus2\\"", "  name:\\"customdatasearch\\"", "  sku.name:\\"standard\\"", "  tags.ProjectType:\\"aoai-your-data-service\\"", "  type:\\"Microsoft.Search/searchServices\\"", "  ", "  -Microsoft.Storage/storageAccounts/clitranslatorapi", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Storage/storageAccounts/clitranslatorapi\\"", "  kind:\\"Storage\\"", "  location:\\"westus\\"", "  name:\\"clitranslatorapi\\"", "  sku.name:\\"Standard_LRS\\"", "  sku.tier:\\"Standard\\"", "  type:\\"Microsoft.Storage/storageAccounts\\"", "  ", "  -Microsoft.Storage/storageAccounts/customdataforgpt", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Storage/storageAccounts/customdataforgpt\\"", "  kind:\\"StorageV2\\"", "  location:\\"eastus\\"", "  name:\\"customdataforgpt\\"", "  sku.name:\\"Standard_RAGRS\\"", "  sku.tier:\\"Standard\\"", "  tags.ProjectType:\\"aoai-your-data-service\\"", "  type:\\"Microsoft.Storage/storageAccounts\\"", "  ", "  -Microsoft.Storage/storageAccounts/translatortempfiles", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Storage/storageAccounts/translatortempfiles\\"", "  kind:\\"StorageV2\\"", "  location:\\"eastasia\\"", "  name:\\"translatortempfiles\\"", "  sku.name:\\"Standard_LRS\\"", "  sku.tier:\\"Standard\\"", "  type:\\"Microsoft.Storage/storageAccounts\\"", "  ", "  -Microsoft.Web/serverFarms/ASP-clitranslatorrg-bdc9", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Web/serverFarms/ASP-clitranslatorrg-bdc9\\"", "  kind:\\"functionapp\\"", "  location:\\"westus\\"", "  name:\\"ASP-clitranslatorrg-bdc9\\"", "  sku.capacity:0", "  sku.family:\\"Y\\"", "  sku.name:\\"Y1\\"", "  sku.size:\\"Y1\\"", "  sku.tier:\\"Dynamic\\"", "  type:\\"Microsoft.Web/serverFarms\\"", "  ", "  -Microsoft.Web/sites/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Web/sites/cli-translator\\"", "  kind:\\"functionapp,linux\\"", "  location:\\"westus\\"", "  name:\\"cli-translator\\"", "  tags.hidden-link:/app-insights-conn-string:\\"InstrumentationKey=11b638ce-0c16-42cc-9516-58122a1922ef;IngestionEndpoint=https://westus-0.in.applicationinsights.azure.com/;LiveEndpoint=https://westus.livediagnostics.monitor.azure.com/\\"", "  tags.hidden-link:/app-insights-instrumentation-key:\\"11b638ce-0c16-42cc-9516-58122a1922ef\\"", "  tags.hidden-link:/app-insights-resource-id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/microsoft.insights/components/cli-translator\\"", "  type:\\"Microsoft.Web/sites\\"", "  ", "  -microsoft.alertsmanagement/smartDetectorAlertRules/FailureAnomalies-cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/microsoft.alertsmanagement/smartDetectorAlertRules/FailureAnomalies-cli-translator\\"", "  location:\\"global\\"", "  name:\\"FailureAnomalies-cli-translator\\"", "  type:\\"microsoft.alertsmanagement/smartDetectorAlertRules\\"", "  ", "  -microsoft.insights/components/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/microsoft.insights/components/cli-translator\\"", "  kind:\\"web\\"", "  location:\\"westus\\"", "  name:\\"cli-translator\\"", "  type:\\"microsoft.insights/components\\"", "  ", "  +Microsoft.Compute/virtualMachines/zytest/extensions/SqlIaasExtension[]", "  ", "  apiVersion:\\"\\"", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Compute/virtualMachines/zytest/extensions/SqlIaasExtension\\"", "  location:\\"westus\\"", "  name:\\"SqlIaasExtension\\"", "  properties.autoUpgradeMinorVersion:true", "  properties.protectedSettings:\\"*******\\"", "  properties.publisher:\\"Microsoft.SqlServer.Management\\"", "  properties.settings.AutoBackupSettings.Enable:true", "  properties.settings.AutoBackupSettings.EnableEncryption:true", "- properties.settings.AutoBackupSettings.RetentionPeriod:\\"2\\"", "?                                                        - -\\n", "+ properties.settings.AutoBackupSettings.RetentionPeriod:2", "- properties.type:\\"SqlIaaSAgent\\"", "?                        ^^^  ^\\n", "+ properties.type:\\"SqlIaasExtension\\"", "?                        ^^^^  ^^^^\\n", "  properties.typeHandlerVersion:\\"1.2\\"", "  type:\\"Microsoft.Compute/virtualMachines/extensions\\"", "  ", "  Resourcechanges:10todelete,1tocreate."], "diff_summary": {"added": 2, "deleted": 2, "differential_rate": "0.033"}}