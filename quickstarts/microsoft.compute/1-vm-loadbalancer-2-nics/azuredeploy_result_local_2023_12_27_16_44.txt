arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"adminPassword": {"type": "securestring", "metadata": {"description": "Admin password."}, "defaultValue": "zytest"}, "adminUsername": {"type": "string", "metadata": {"description": "Admin username."}, "defaultValue": "zytest"}, "dnsNameforLBIP": {"type": "string", "metadata": {"description": "DNS for Load Balancer IP."}, "defaultValue": "zytest"}, "location": {"type": "string", "metadata": {"description": "Location for all resources."}, "defaultValue": "westus"}, "storageAccountName": {"type": "string", "defaultValue": "zytest", "metadata": {"description": "Name of storage account."}}, "vmSize": {"type": "string", "defaultValue": "Standard_D2_v3", "metadata": {"description": "Size of the virtual machine."}}}, "variables": {"addressPrefix": "10.0.0.0/16", "imageOffer": "WindowsServer", "imagePublisher": "MicrosoftWindowsServer", "imageSKU": "2019-Datacenter", "lbName": "myLB", "networkSecurityGroupName": "[concat(variables(\'subnetName\'), \'-nsg\')]", "nic1NamePrefix": "nic1", "nic2NamePrefix": "nic2", "publicIPAddressName": "myPublicIP", "publicIPAddressType": "Dynamic", "storageAccountType": "Standard_LRS", "subnetName": "Subnet-1", "subnetPrefix": "10.0.0.0/24", "vmNamePrefix": "myVM", "vnetName": "myVNET"}, "resources": [{"type": "Microsoft.Storage/storageAccounts", "name": "[parameters(\'storageAccountName\')]", "apiVersion": "2019-06-01", "location": "[parameters(\'location\')]", "sku": {"name": "[variables(\'storageAccountType\')]"}, "kind": "StorageV2"}, {"apiVersion": "2020-05-01", "name": "[variables(\'lbName\')]", "type": "Microsoft.Network/loadBalancers", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Network/publicIPAddresses/\', variables(\'publicIPAddressName\'))]"], "properties": {"frontendIPConfigurations": [{"name": "LoadBalancerFrontEnd", "properties": {"publicIPAddress": {"id": "[resourceId(\'Microsoft.Network/publicIPAddresses\', variables(\'publicIPAddressName\'))]"}}}], "backendAddressPools": [{"name": "BackendPool1"}], "inboundNatRules": [{"name": "RDP-VM0", "properties": {"frontendIPConfiguration": {"id": "[resourceId(\'Microsoft.Network/loadBalancers/frontendIPConfigurations\', variables(\'lbName\'), \'LoadBalancerFrontEnd\')]"}, "protocol": "Tcp", "frontendPort": 50001, "backendPort": 3389, "enableFloatingIP": false}}]}}, {"comments": "Simple Network Security Group for subnet [variables(\'subnetName\')]", "type": "Microsoft.Network/networkSecurityGroups", "apiVersion": "2020-05-01", "name": "[variables(\'networkSecurityGroupName\')]", "location": "[parameters(\'location\')]", "properties": {}}, {"apiVersion": "2020-05-01", "type": "Microsoft.Network/networkInterfaces", "name": "[variables(\'nic1NamePrefix\')]", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Network/virtualNetworks/\', variables(\'vnetName\'))]", "[resourceId(\'Microsoft.Network/loadBalancers/\', variables(\'lbName\'))]"], "properties": {"ipConfigurations": [{"name": "ipconfig1", "properties": {"privateIPAllocationMethod": "Dynamic", "subnet": {"id": "[resourceId(\'Microsoft.Network/virtualNetworks/subnets\', variables(\'vnetName\'), variables(\'subnetName\'))]"}, "loadBalancerBackendAddressPools": [{"id": "[resourceId(\'Microsoft.Network/loadBalancers/backendAddressPools\', variables(\'lbName\'), \'BackendPool1\')]"}], "loadBalancerInboundNatRules": [{"id": "[resourceId(\'Microsoft.Network/loadBalancers/inboundNatRules\', variables(\'lbName\'), \'RDP-VM0\')]"}]}}]}}, {"apiVersion": "2020-05-01", "type": "Microsoft.Network/networkInterfaces", "name": "[variables(\'nic2NamePrefix\')]", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Network/virtualNetworks/\', variables(\'vnetName\'))]"], "properties": {"ipConfigurations": [{"name": "ipconfig1", "properties": {"privateIPAllocationMethod": "Dynamic", "subnet": {"id": "[resourceId(\'Microsoft.Network/virtualNetworks/subnets\', variables(\'vnetName\'), variables(\'subnetName\'))]"}}}]}}, {"apiVersion": "2020-05-01", "type": "Microsoft.Network/publicIPAddresses", "name": "[variables(\'publicIPAddressName\')]", "location": "[parameters(\'location\')]", "properties": {"publicIPAllocationMethod": "[variables(\'publicIPAddressType\')]", "dnsSettings": {"domainNameLabel": "[parameters(\'dnsNameforLBIP\')]"}}}, {"apiVersion": "2019-12-01", "type": "Microsoft.Compute/virtualMachines", "name": "[variables(\'vmNamePrefix\')]", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Storage/storageAccounts/\', parameters(\'storageAccountName\'))]", "[resourceId(\'Microsoft.Network/networkInterfaces/\', variables(\'nic1NamePrefix\'))]", "[resourceId(\'Microsoft.Network/networkInterfaces/\', variables(\'nic2NamePrefix\'))]"], "properties": {"hardwareProfile": {"vmSize": "[parameters(\'vmSize\')]"}, "osProfile": {"computerName": "[variables(\'vmNamePrefix\')]", "adminUsername": "[parameters(\'adminUsername\')]", "adminPassword": "[parameters(\'adminPassword\')]"}, "storageProfile": {"imageReference": {"publisher": "[variables(\'imagePublisher\')]", "offer": "[variables(\'imageOffer\')]", "sku": "[variables(\'imageSKU\')]", "version": "latest"}, "osDisk": {"createOption": "FromImage"}}, "networkProfile": {"networkInterfaces": [{"properties": {"primary": true}, "id": "[resourceId(\'Microsoft.Network/networkInterfaces\',variables(\'nic1NamePrefix\'))]"}, {"properties": {"primary": false}, "id": "[resourceId(\'Microsoft.Network/networkInterfaces\',variables(\'nic2NamePrefix\'))]"}]}, "diagnosticsProfile": {"bootDiagnostics": {"enabled": true, "storageUri": "[reference(parameters(\'storageAccountName\'), \'2019-06-01\').primaryEndpoints.blob]"}}}}, {"apiVersion": "2020-05-01", "type": "Microsoft.Network/virtualNetworks", "name": "[variables(\'vnetName\')]", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Network/networkSecurityGroups\', variables(\'networkSecurityGroupName\'))]"], "properties": {"addressSpace": {"addressPrefixes": ["[variables(\'addressPrefix\')]"]}, "subnets": [{"name": "[variables(\'subnetName\')]", "properties": {"addressPrefix": "[variables(\'subnetPrefix\')]", "networkSecurityGroup": {"id": "[resourceId(\'Microsoft.Network/networkSecurityGroups\', variables(\'networkSecurityGroupName\'))]"}}}]}}]}


cli_script
Based on the provided ARM template and parameters, here is the corresponding Azure CLI script written in bash:\n\n```bash\n#!/bin/bash\n\n# Template Parameters\nadminPassword="zytest" # Default value for adminPassword\nadminUsername="zytest" # Default value for adminUsername\ndnsNameforLBIP="zytest" # Default value for dnsNameforLBIP\nlocation="westus" # Default value for location\nstorageAccountName="zytest" # Default value for storageAccountName\nvmSize="Standard_D2_v3" # Default value for vmSize\n\n# Variables\naddressPrefix="10.0.0.0/16"\nimageOffer="WindowsServer"\nimagePublisher="MicrosoftWindowsServer"\nimageSKU="2019-Datacenter"\nlbName="myLB"\nnetworkSecurityGroupName="Subnet-1-nsg" # Concatenated value\nnic1NamePrefix="nic1"\nnic2NamePrefix="nic2"\npublicIPAddressName="myPublicIP"\npublicIPAddressType="Dynamic"\nstorageAccountType="Standard_LRS"\nsubnetName="Subnet-1"\nsubnetPrefix="10.0.0.0/24"\nvmNamePrefix="myVM"\nvnetName="myVNET"\n\n# Create Storage Account\naz storage account create \\\n    --name $storageAccountName \\\n    --location $location \\\n    --sku $storageAccountType \\\n    --kind StorageV2\n\n# Create Public IP Address\naz network public-ip create \\\n    --name $publicIPAddressName \\\n    --location $location \\\n    --allocation-method $publicIPAddressType \\\n    --dns-name $dnsNameforLBIP\n\n# Create Load Balancer\naz network lb create \\\n    --name $lbName \\\n    --location $location \\\n    --frontend-ip-name LoadBalancerFrontEnd \\\n    --backend-pool-name BackendPool1 \\\n    --public-ip-address $publicIPAddressName\n\n# Create Load Balancer NAT Rule for RDP\naz network lb inbound-nat-rule create \\\n    --resource-group <YourResourceGroupName> \\\n    --lb-name $lbName \\\n    --name RDP-VM0 \\\n    --protocol Tcp \\\n    --frontend-port 50001 \\\n    --backend-port 3389 \\\n    --frontend-ip-name LoadBalancerFrontEnd\n\n# Create Network Security Group\naz network nsg create \\\n    --name $networkSecurityGroupName \\\n    --location $location\n\n# Create Virtual Network\naz network vnet create \\\n    --name $vnetName \\\n    --location $location \\\n    --address-prefix $addressPrefix \\\n    --subnet-name $subnetName \\\n    --subnet-prefix $subnetPrefix \\\n    --network-security-group $networkSecurityGroupName\n\n# Create Network Interface 1\naz network nic create \\\n    --name $nic1NamePrefix \\\n    --location $location \\\n    --vnet-name $vnetName \\\n    --subnet $subnetName \\\n    --lb-name $lbName \\\n    --lb-address-pools BackendPool1 \\\n    --lb-inbound-nat-rules RDP-VM0\n\n# Create Network Interface 2\naz network nic create \\\n    --name $nic2NamePrefix \\\n    --location $location \\\n    --vnet-name $vnetName \\\n    --subnet $subnetName\n\n# Create Virtual Machine\naz vm create \\\n    --name $vmNamePrefix \\\n    --location $location \\\n    --nics $nic1NamePrefix $nic2NamePrefix \\\n    --admin-username $adminUsername \\\n    --admin-password $adminPassword \\\n    --size $vmSize \\\n    --image $imagePublisher:$imageOffer:$imageSKU:latest \\\n    --storage-sku $storageAccountType \\\n    --os-disk-name "${vmNamePrefix}OSDisk" \\\n    --boot-diagnostics-storage $storageAccountName\n```\n\nPlease replace `<YourResourceGroupName>` with your actual resource group name where the load balancer resides. The script assumes that you are logged in to Azure CLI and have the necessary permissions to create these resources. Additionally, the script sets default values for the parameters and uses the provided variables from the ARM template.


verify_result
