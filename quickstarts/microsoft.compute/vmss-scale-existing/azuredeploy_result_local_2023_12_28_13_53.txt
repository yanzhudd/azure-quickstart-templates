arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"namingInfix": {"type": "string", "metadata": {"description": "Naming infix of existing VM Scale Set."}, "defaultValue": "zytest"}, "location": {"type": "string", "defaultValue": "westus", "metadata": {"description": "Default location"}}}, "resources": [{"type": "Microsoft.Insights/autoscaleSettings", "apiVersion": "2015-04-01", "name": "autoscalewad", "location": "[parameters(\'location\')]", "properties": {"name": "autoscalewad", "targetResourceUri": "[resourceId(\'Microsoft.Compute/virtualMachineScaleSets/\', parameters(\'namingInfix\'))]", "enabled": true, "profiles": [{"name": "Profile1", "capacity": {"minimum": "1", "maximum": "10", "default": "1"}, "rules": [{"metricTrigger": {"metricName": "Percentage CPU", "metricResourceUri": "[resourceId(\'Microsoft.Compute/virtualMachineScaleSets/\', parameters(\'namingInfix\'))]", "timeGrain": "PT1M", "statistic": "Average", "timeWindow": "PT5M", "timeAggregation": "Average", "operator": "GreaterThan", "threshold": 60}, "scaleAction": {"direction": "Increase", "type": "ChangeCount", "value": "3", "cooldown": "PT1M"}}, {"metricTrigger": {"metricName": "Percentage CPU", "metricResourceUri": "[resourceId(\'Microsoft.Compute/virtualMachineScaleSets/\', parameters(\'namingInfix\'))]", "timeGrain": "PT1M", "statistic": "Average", "timeWindow": "PT5M", "timeAggregation": "Average", "operator": "LessThan", "threshold": 30}, "scaleAction": {"direction": "Decrease", "type": "ChangeCount", "value": "1", "cooldown": "PT5M"}}]}]}}]}


cli_script
```bash\n#!/bin/bash\n\n# Define template parameters as variables\nnamingInfix="zytest" # Naming infix of existing VM Scale Set.\nlocation="westus" # Default location\n\n# Get the resource ID of the virtual machine scale set\nvmssResourceId=$(az vmss show --name $namingInfix --query "id" --output tsv)\n\n# Create or update autoscale setting\naz monitor autoscale create \\\n  --name "autoscalewad" \\\n  --resource-group "<resource-group-name>" \\ # Replace with your resource group name\n  --location "$location" \\\n  --target "$vmssResourceId" \\\n  --min-count 1 \\\n  --max-count 10 \\\n  --count 1 \\\n  --rules "[\n    {\n      \'metric_name\': \'Percentage CPU\',\n      \'metric_resource_uri\': \'$vmssResourceId\',\n      \'time_grain\': \'PT1M\',\n      \'statistic\': \'Average\',\n      \'time_window\': \'PT5M\',\n      \'time_aggregation\': \'Average\',\n      \'operator\': \'GreaterThan\',\n      \'threshold\': 60,\n      \'direction\': \'Increase\',\n      \'change_count\': 3,\n      \'cooldown\': \'PT1M\'\n    },\n    {\n      \'metric_name\': \'Percentage CPU\',\n      \'metric_resource_uri\': \'$vmssResourceId\',\n      \'time_grain\': \'PT1M\',\n      \'statistic\': \'Average\',\n      \'time_window\': \'PT5M\',\n      \'time_aggregation\': \'Average\',\n      \'operator\': \'LessThan\',\n      \'threshold\': 30,\n      \'direction\': \'Decrease\',\n      \'change_count\': 1,\n      \'cooldown\': \'PT5M\'\n    }\n  ]"\n```\n\nPlease replace `<resource-group-name>` with the actual name of your resource group where the virtual machine scale set is located. This script assumes you have the Azure CLI installed and are logged in with sufficient permissions to create or update autoscale settings in the specified resource group.


verify_result
