arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"adminUsername": {"type": "string", "metadata": {"description": "User name for the Virtual Machine."}, "defaultValue": "zytest"}, "adminPassword": {"type": "securestring", "metadata": {"description": "Password for the Virtual Machine."}, "defaultValue": "zytest"}, "vmSize": {"type": "string", "metadata": {"description": "Size of the virtual machine"}, "defaultValue": "Standard_A1_v2"}, "keyVaultName": {"type": "string", "metadata": {"description": "Name of the KeyVault to place the volume encryption key"}, "defaultValue": "zytest"}, "keyVaultResourceGroup": {"type": "string", "metadata": {"description": "Resource group of the KeyVault"}, "defaultValue": "zytest"}, "keyEncryptionKeyURL": {"type": "string", "defaultValue": "", "metadata": {"description": "URL of the KeyEncryptionKey used to encrypt the volume encryption key"}}, "location": {"type": "string", "defaultValue": "westus", "metadata": {"description": "Location for all resources."}}}, "variables": {"nicName": "myVMNic", "subnetName": "Subnet", "vmName": "MyWindowsVM", "virtualNetworkName": "MyVNET", "subnetRef": "[resourceId(\'Microsoft.Network/virtualNetworks/subnets/\', variables(\'virtualNetworkName\'), variables(\'subnetName\'))]", "extensionName": "AzureDiskEncryption", "extensionVersion": "2.2", "encryptionOperation": "EnableEncryption", "keyEncryptionAlgorithm": "RSA-OAEP", "keyVaultResourceID": "[resourceId(parameters(\'keyVaultResourceGroup\'), \'Microsoft.KeyVault/vaults/\', parameters(\'keyVaultName\'))]"}, "resources": [{"apiVersion": "2020-05-01", "type": "Microsoft.Network/virtualNetworks", "name": "[variables(\'virtualNetworkName\')]", "location": "[parameters(\'location\')]", "properties": {"addressSpace": {"addressPrefixes": ["10.0.0.0/16"]}, "subnets": [{"name": "[variables(\'subnetName\')]", "properties": {"addressPrefix": "10.0.0.0/24"}}]}}, {"apiVersion": "2020-05-01", "type": "Microsoft.Network/networkInterfaces", "name": "[variables(\'nicName\')]", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Network/virtualNetworks/\', variables(\'virtualNetworkName\'))]"], "properties": {"ipConfigurations": [{"name": "ipconfig1", "properties": {"privateIPAllocationMethod": "Dynamic", "subnet": {"id": "[variables(\'subnetRef\')]"}}}]}}, {"apiVersion": "2019-12-01", "type": "Microsoft.Compute/virtualMachines", "name": "[variables(\'vmName\')]", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Network/networkInterfaces/\', variables(\'nicName\'))]"], "properties": {"hardwareProfile": {"vmSize": "[parameters(\'vmSize\')]"}, "osProfile": {"computerName": "[variables(\'vmName\')]", "adminUsername": "[parameters(\'adminUsername\')]", "adminPassword": "[parameters(\'adminPassword\')]"}, "storageProfile": {"imageReference": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "2019-Datacenter", "version": "latest"}, "osDisk": {"createOption": "FromImage"}, "dataDisks": [{"diskSizeGB": "1023", "lun": 0, "createOption": "Empty"}]}, "networkProfile": {"networkInterfaces": [{"id": "[resourceId(\'Microsoft.Network/networkInterfaces\',variables(\'nicName\'))]"}]}}}, {"type": "Microsoft.Compute/virtualMachines/extensions", "name": "[concat(variables(\'vmName\'),\'/\', variables(\'extensionName\'))]", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Compute/virtualMachines/\', variables(\'vmName\'))]"], "apiVersion": "2019-12-01", "properties": {"publisher": "Microsoft.Azure.Security", "type": "[variables(\'extensionName\')]", "typeHandlerVersion": "[variables(\'extensionVersion\')]", "autoUpgradeMinorVersion": true, "forceUpdateTag": "1.0", "settings": {"EncryptionOperation": "[variables(\'encryptionOperation\')]", "KeyVaultURL": "[reference(variables(\'keyVaultResourceId\'),\'2018-02-14-preview\').vaultUri]", "KeyVaultResourceId": "[variables(\'keyVaultResourceID\')]", "KeyEncryptionKeyURL": "[parameters(\'keyEncryptionKeyURL\')]", "KekVaultResourceId": "[variables(\'keyVaultResourceID\')]", "KeyEncryptionAlgorithm": "[variables(\'keyEncryptionAlgorithm\')]", "VolumeType": "All", "ResizeOSDisk": false}}}], "outputs": {"vmName": {"type": "string", "value": "[variables(\'vmName\')]"}}}


cli_script
Based on the provided ARM template and template parameters, the following bash script translates the ARM template into Azure CLI commands:\n\n```bash\n#!/bin/bash\n\n# Assigning parameter values to variables\nadminUsername="zytest"\nadminPassword="zytest"\nvmSize="Standard_A1_v2"\nkeyVaultName="zytest"\nkeyVaultResourceGroup="zytest"\nkeyEncryptionKeyURL=""\nlocation="westus"\n\n# Assigning variable values from ARM template\nnicName="myVMNic"\nsubnetName="Subnet"\nvmName="MyWindowsVM"\nvirtualNetworkName="MyVNET"\n# Since the ARM template uses resourceId function, we need to manually construct the resource ID for subnet\nsubnetRef="/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Network/virtualNetworks/$virtualNetworkName/subnets/$subnetName"\n# Similarly, construct the resource ID for the Key Vault\nkeyVaultResourceID="/subscriptions/{subscriptionId}/resourceGroups/$keyVaultResourceGroup/providers/Microsoft.KeyVault/vaults/$keyVaultName"\nextensionName="AzureDiskEncryption"\nextensionVersion="2.2"\nencryptionOperation="EnableEncryption"\nkeyEncryptionAlgorithm="RSA-OAEP"\n\n# Create Virtual Network\naz network vnet create \\\n    --name $virtualNetworkName \\\n    --resource-group {resourceGroupName} \\\n    --location $location \\\n    --address-prefixes "10.0.0.0/16" \\\n    --subnet-name $subnetName \\\n    --subnet-prefix "10.0.0.0/24"\n\n# Create Network Interface\naz network nic create \\\n    --name $nicName \\\n    --resource-group {resourceGroupName} \\\n    --location $location \\\n    --vnet-name $virtualNetworkName \\\n    --subnet $subnetName\n\n# Create Virtual Machine\naz vm create \\\n    --name $vmName \\\n    --resource-group {resourceGroupName} \\\n    --location $location \\\n    --nics $nicName \\\n    --size $vmSize \\\n    --admin-username $adminUsername \\\n    --admin-password $adminPassword \\\n    --image "MicrosoftWindowsServer:WindowsServer:2019-Datacenter:latest" \\\n    --data-disk-sizes-gb 1023\n\n# Create VM Extension for Azure Disk Encryption\naz vm extension set \\\n    --name $extensionName \\\n    --vm-name $vmName \\\n    --resource-group {resourceGroupName} \\\n    --publisher "Microsoft.Azure.Security" \\\n    --version $extensionVersion \\\n    --settings "{\'EncryptionOperation\': \'$encryptionOperation\', \'KeyVaultURL\': \'\', \'KeyVaultResourceId\': \'$keyVaultResourceID\', \'KeyEncryptionKeyURL\': \'$keyEncryptionKeyURL\', \'KekVaultResourceId\': \'$keyVaultResourceID\', \'KeyEncryptionAlgorithm\': \'$keyEncryptionAlgorithm\', \'VolumeType\': \'All\', \'ResizeOSDisk\': false}"\n\n# Output the VM name\necho "VM Name: $vmName"\n```\n\nPlease note that you need to replace `{subscriptionId}` and `{resourceGroupName}` with your actual subscription ID and resource group name. Additionally, the `KeyVaultURL` should be replaced with the actual URL of your Key Vault if you have one.\n\nThis script assumes that you have already logged in to Azure CLI and set the correct subscription context using `az login` and `az account set`.


verify_result
