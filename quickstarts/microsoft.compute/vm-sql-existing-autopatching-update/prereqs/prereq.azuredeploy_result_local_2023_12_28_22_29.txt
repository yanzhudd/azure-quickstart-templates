arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"vmSize": {"type": "string", "metadata": {"description": "Virtual Machine size"}, "defaultValue": "zytest"}, "adminUsername": {"type": "string", "metadata": {"description": "Username to access virtual Machines"}, "defaultValue": "zytest"}, "adminPassword": {"type": "securestring", "minLength": 12, "metadata": {"description": "Password to access virtual Machines"}, "defaultValue": "zytest"}, "location": {"type": "string", "defaultValue": "westus", "metadata": {"description": "Location for all resources."}}}, "variables": {"storageAccountName": "[concat(uniqueString(resourceGroup().id),\'storage\')]", "vmNSGName": "ExistingNsg", "ipAddressName": "ExistingPip", "virtualNetworkName": "ExistingVNet", "vmNicName": "ExistingNic", "vmName": "ExistingWinVm"}, "resources": [{"type": "Microsoft.Storage/storageAccounts", "name": "[variables(\'storageAccountName\')]", "apiVersion": "2020-08-01-preview", "location": "[parameters(\'location\')]", "comments": "Storage account used to store VM disks", "tags": {"displayName": "Storage Account"}, "sku": {"name": "Standard_LRS"}, "kind": "Storage", "properties": {}}, {"type": "Microsoft.Network/networkSecurityGroups", "name": "[variables(\'vmNSGName\')]", "apiVersion": "2016-03-30", "location": "[parameters(\'location\')]", "comments": "NSG for the VM subnet.", "tags": {"displayName": "VM NSG"}}, {"type": "Microsoft.Network/publicIPAddresses", "name": "[variables(\'ipAddressName\')]", "apiVersion": "2016-03-30", "location": "[parameters(\'location\')]", "comments": " Public IP used by the Jump VM", "tags": {"displayName": "VM Public IP"}, "properties": {"publicIPAllocationMethod": "Static", "idleTimeoutInMinutes": 4}}, {"type": "Microsoft.Network/virtualNetworks", "name": "[variables(\'virtualNetworkName\')]", "apiVersion": "2016-03-30", "location": "[parameters(\'location\')]", "comments": "Virtual network for overall solution", "tags": {"displayName": "Virtual Network"}, "dependsOn": ["[resourceId(\'Microsoft.Network/networkSecurityGroups\', variables(\'vmNSGName\'))]"], "properties": {"addressSpace": {"addressPrefixes": ["10.0.0.0/16"]}, "subnets": [{"name": "default", "properties": {"addressPrefix": "10.0.1.0/24", "networkSecurityGroup": {"id": "[resourceId(\'Microsoft.Network/networkSecurityGroups\', variables(\'vmNSGName\'))]"}}}]}}, {"type": "Microsoft.Network/networkInterfaces", "name": "[variables(\'vmNicName\')]", "apiVersion": "2016-03-30", "location": "[parameters(\'location\')]", "comments": "NIC for the VM", "tags": {"displayName": "VM NIC"}, "dependsOn": ["[resourceId(\'Microsoft.Network/virtualNetworks\', variables(\'virtualNetworkName\'))]"], "properties": {"ipConfigurations": [{"name": "ipconfig1", "properties": {"privateIPAllocationMethod": "Dynamic", "publicIPAddress": {"id": "[resourceId(\'Microsoft.Network/publicIPAddresses\',variables(\'ipAddressName\'))]"}, "subnet": {"id": "[resourceId(\'Microsoft.Network/virtualNetworks/subnets\', variables(\'virtualNetworkName\'),\'default\')]"}}}]}}, {"type": "Microsoft.Compute/virtualMachines", "name": "[variables(\'vmName\')]", "apiVersion": "2017-03-30", "location": "[parameters(\'location\')]", "comments": "Windows VM", "tags": {"displayName": "Virtual Machine"}, "dependsOn": ["[resourceId(\'Microsoft.Storage/storageAccounts\', variables(\'storageAccountName\'))]", "[resourceId(\'Microsoft.Network/networkInterfaces\', variables(\'vmNicName\'))]"], "properties": {"hardwareProfile": {"vmSize": "[parameters(\'vmSize\')]"}, "osProfile": {"computerName": "windowsvm", "adminUsername": "[parameters(\'adminUsername\')]", "adminPassword": "[parameters(\'adminPassword\')]", "windowsConfiguration": {"provisionVmAgent": "true"}}, "storageProfile": {"imageReference": {"publisher": "MicrosoftSQLServer", "offer": "SQL2014SP2-WS2012R2", "sku": "Enterprise", "version": "latest"}, "osDisk": {"name": "[concat(variables(\'vmName\'), \'_OSDisk\')]", "caching": "ReadWrite", "createOption": "FromImage"}, "dataDisks": [{"name": "[concat(variables(\'vmName\'), \'_DataDisk1\')]", "createOption": "Empty", "lun": 0, "diskSizeGB": 1023, "caching": "ReadOnly"}]}, "networkProfile": {"networkInterfaces": [{"id": "[resourceId(\'Microsoft.Network/networkInterfaces\', variables(\'vmNicName\'))]"}]}, "diagnosticsProfile": {"bootDiagnostics": {"enabled": true, "storageUri": "[reference(resourceId(\'Microsoft.Storage/storageAccounts/\', variables(\'storageAccountName\'))).primaryEndpoints.blob]"}}}}, {"apiVersion": "2020-12-01", "type": "Microsoft.Compute/virtualMachines/extensions", "name": "[concat(variables(\'vmName\'), \'/SqlIaasExtension\')]", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Compute/virtualMachines\', variables(\'vmName\'))]"], "properties": {"type": "SqlIaaSAgent", "publisher": "Microsoft.SqlServer.Management", "typeHandlerVersion": "1.2", "autoUpgradeMinorVersion": "true", "settings": {"AutoTelemetrySettings": {"Region": "[parameters(\'location\')]"}, "AutoPatchingSettings": {"PatchCategory": "WindowsMandatoryUpdates", "Enable": true, "DayOfWeek": "Sunday", "MaintenanceWindowStartingHour": "2", "MaintenanceWindowDuration": "60"}, "KeyVaultCredentialSettings": {"Enable": false}, "ServerConfigurationsManagementSettings": {"SQLConnectivityUpdateSettings": {"ConnectivityType": "Private", "Port": "1433"}, "SQLWorkloadTypeUpdateSettings": {"SQLWorkloadType": "GENERAL"}, "SQLStorageUpdateSettings": {"DiskCount": "1", "NumberOfColumns": "1", "StartingDeviceID": "2", "DiskConfigurationType": "NEW"}, "AdditionalFeaturesServerConfigurations": {"IsRServicesEnabled": "false"}}}}}], "outputs": {"existingVirtualMachineName": {"type": "string", "value": "[variables(\'vmName\')]"}}}


cli_script
Below is the translated Azure CLI script from the provided ARM template and template parameters. Note that the ARM template variables and parameters have been translated into bash variables, and each resource has been translated into the corresponding Azure CLI command.\n\n```bash\n#!/bin/bash\n\n# Template Parameters\nvmSize="zytest"\nadminUsername="zytest"\nadminPassword="zytest"\nlocation="westus"\n\n# Variables\nresourceGroupName=$(az group show --query name --output tsv)\nstorageAccountName=$(az storage account list --resource-group $resourceGroupName --query "[?starts_with(name,\'$resourceGroupName\')].name" --output tsv)\nvmNSGName="ExistingNsg"\nipAddressName="ExistingPip"\nvirtualNetworkName="ExistingVNet"\nvmNicName="ExistingNic"\nvmName="ExistingWinVm"\n\n# Create Storage Account\n# Storage account used to store VM disks\naz storage account create \\\n    --name $storageAccountName \\\n    --location $location \\\n    --sku Standard_LRS \\\n    --kind StorageV2 \\\n    --tags displayName="Storage Account"\n\n# Create Network Security Group\n# NSG for the VM subnet.\naz network nsg create \\\n    --name $vmNSGName \\\n    --location $location \\\n    --tags displayName="VM NSG"\n\n# Create Public IP Address\n# Public IP used by the Jump VM\naz network public-ip create \\\n    --name $ipAddressName \\\n    --location $location \\\n    --allocation-method Static \\\n    --idle-timeout 4 \\\n    --tags displayName="VM Public IP"\n\n# Create Virtual Network with a Subnet\n# Virtual network for overall solution\naz network vnet create \\\n    --name $virtualNetworkName \\\n    --location $location \\\n    --address-prefixes "10.0.0.0/16" \\\n    --subnet-name "default" \\\n    --subnet-prefix "10.0.1.0/24" \\\n    --network-security-group $vmNSGName \\\n    --tags displayName="Virtual Network"\n\n# Create Network Interface\n# NIC for the VM\naz network nic create \\\n    --name $vmNicName \\\n    --location $location \\\n    --vnet-name $virtualNetworkName \\\n    --subnet "default" \\\n    --public-ip-address $ipAddressName \\\n    --tags displayName="VM NIC"\n\n# Create Virtual Machine\n# Windows VM\naz vm create \\\n    --name $vmName \\\n    --location $location \\\n    --nics $vmNicName \\\n    --size $vmSize \\\n    --admin-username $adminUsername \\\n    --admin-password $adminPassword \\\n    --image "MicrosoftSQLServer:SQL2014SP2-WS2012R2:Enterprise:latest" \\\n    --os-disk-name "${vmName}_OSDisk" \\\n    --data-disk-sizes-gb 1023 \\\n    --tags displayName="Virtual Machine" \\\n    --storage-sku Standard_LRS\n\n# Create VM Extension for SQL Server\n# SQL Server IaaS Agent Extension\naz vm extension set \\\n    --vm-name $vmName \\\n    --name "SqlIaasExtension" \\\n    --publisher "Microsoft.SqlServer.Management" \\\n    --version "1.2" \\\n    --settings \'{"AutoTelemetrySettings":{"Region":"\'$location\'"},"AutoPatchingSettings":{"PatchCategory":"WindowsMandatoryUpdates","Enable":true,"DayOfWeek":"Sunday","MaintenanceWindowStartingHour":2,"MaintenanceWindowDuration":60},"KeyVaultCredentialSettings":{"Enable":false},"ServerConfigurationsManagementSettings":{"SQLConnectivityUpdateSettings":{"ConnectivityType":"Private","Port":1433},"SQLWorkloadTypeUpdateSettings":{"SQLWorkloadType":"GENERAL"},"SQLStorageUpdateSettings":{"DiskCount":1,"NumberOfColumns":1,"StartingDeviceID":2,"DiskConfigurationType":"NEW"},"AdditionalFeaturesServerConfigurations":{"IsRServicesEnabled":false}}}\'\n```\n\nPlease ensure that the resource group name and storage account name are correctly set in the script. The variable `resourceGroupName` is used to fetch the current resource group name, and `storageAccountName` is set to match the pattern from the ARM template. Adjust these as necessary based on your actual Azure environment.


verify_result
