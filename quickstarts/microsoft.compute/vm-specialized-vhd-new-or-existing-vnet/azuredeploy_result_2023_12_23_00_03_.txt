arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"vmName": {"type": "string", "defaultValue": "newvm", "metadata": {"description": "Name of the VM"}}, "osType": {"type": "string", "allowedValues": ["Windows", "Linux"], "defaultValue": "Windows", "metadata": {"description": "Type of OS on the existing vhd"}}, "osDiskVhdUri": {"type": "string", "metadata": {"description": "Uri of the existing VHD in ARM standard or premium storage"}, "defaultValue": "zytest"}, "vmSize": {"type": "string", "defaultValue": "Standard_D2s_v3", "metadata": {"description": "Size of the VM"}}, "vNetNewOrExisting": {"type": "string", "defaultValue": "new", "allowedValues": ["new", "existing"], "metadata": {"description": "Specify whether to create a new or existing virtual network for the VM."}}, "virtualNetworkName": {"type": "string", "defaultValue": "newVnet", "metadata": {"description": "Name of the existing VNET"}}, "virtualNetworkResourceGroup": {"type": "string", "defaultValue": "[resourceGroup().name]", "metadata": {"description": "Name of the existing VNET resource group"}}, "subnetName": {"type": "string", "defaultValue": "subnet-1", "metadata": {"description": "Name of the subnet in the virtual network you want to use"}}, "dnsNameForPublicIP": {"type": "string", "defaultValue": "[concat(\'vm-\', uniqueString(resourceGroup().id))]", "metadata": {"description": "Unique DNS Name for the Public IP used to access the Virtual Machine."}}, "location": {"type": "string", "defaultValue": "westus", "metadata": {"description": "Location for all resources."}}}, "variables": {"diagStorageAccountName": "[concat(uniquestring(resourceGroup().id), \'specvm\')]", "subnetRef": "[resourceId(parameters(\'virtualNetworkResourceGroup\'), \'Microsoft.Network/virtualNetworks/subnets\', parameters(\'virtualNetworkName\'),  parameters(\'subnetName\'))]", "nicName": "nic", "publicIPAddressName": "publicIp", "diskName": "[concat(parameters(\'vmName\'), \'-disk\')]"}, "resources": [{"condition": "[equals(parameters(\'vNetNewOrExisting\'), \'new\')]", "apiVersion": "2020-08-01", "type": "Microsoft.Network/virtualNetworks", "name": "[parameters(\'virtualNetworkName\')]", "location": "[parameters(\'location\')]", "properties": {"addressSpace": {"addressPrefixes": ["10.0.0.0/16"]}, "subnets": [{"name": "[parameters(\'subnetName\')]", "properties": {"addressPrefix": "10.0.0.0/24"}}]}}, {"type": "Microsoft.Storage/storageAccounts", "name": "[variables(\'diagStorageAccountName\')]", "apiVersion": "2018-07-01", "location": "[parameters(\'location\')]", "sku": {"name": "Standard_LRS"}, "kind": "Storage", "properties": {}}, {"apiVersion": "2018-10-01", "type": "Microsoft.Network/publicIPAddresses", "name": "[variables(\'publicIPAddressName\')]", "location": "[parameters(\'location\')]", "tags": {"displayName": "PublicIPAddress"}, "properties": {"publicIPAllocationMethod": "Dynamic", "dnsSettings": {"domainNameLabel": "[parameters(\'dnsNameForPublicIP\')]"}}}, {"apiVersion": "2018-10-01", "type": "Microsoft.Network/networkInterfaces", "name": "[variables(\'nicName\')]", "location": "[parameters(\'location\')]", "dependsOn": ["[variables(\'publicIPAddressName\')]"], "tags": {"displayName": "NetworkInterface"}, "properties": {"ipConfigurations": [{"name": "ipconfig1", "properties": {"privateIPAllocationMethod": "Dynamic", "publicIPAddress": {"id": "[resourceId(\'Microsoft.Network/publicIPAddresses\', variables(\'publicIPAddressName\'))]"}, "subnet": {"id": "[variables(\'subnetRef\')]"}}}]}}, {"type": "Microsoft.Compute/disks", "apiVersion": "2018-09-30", "name": "[variables(\'diskName\')]", "location": "[parameters(\'location\')]", "properties": {"creationData": {"createOption": "Import", "sourceUri": "[parameters(\'osDiskVhdUri\')]"}, "osType": "[parameters(\'osType\')]"}}, {"apiVersion": "2018-10-01", "type": "Microsoft.Compute/virtualMachines", "name": "[parameters(\'vmName\')]", "location": "[parameters(\'location\')]", "tags": {"displayName": "VirtualMachine"}, "dependsOn": ["[variables(\'nicName\')]", "[variables(\'diskName\')]"], "properties": {"hardwareProfile": {"vmSize": "[parameters(\'vmSize\')]"}, "storageProfile": {"osDisk": {"osType": "[parameters(\'osType\')]", "createOption": "Attach", "managedDisk": {"id": "[resourceId(\'Microsoft.Compute/disks\', variables(\'diskName\'))]"}}}, "networkProfile": {"networkInterfaces": [{"id": "[resourceId(\'Microsoft.Network/networkInterfaces\', variables(\'nicName\'))]"}]}, "diagnosticsProfile": {"bootDiagnostics": {"enabled": true, "storageUri": "[reference(variables(\'diagStorageAccountName\')).primaryEndpoints.blob]"}}}}]}


cli_script
Here is the equivalent CLI script:\n\n```bash\n#!/bin/bash\n\n# Define parameters\nvmName="newvm"\nosType="Windows"\nosDiskVhdUri="zytest"\nvmSize="Standard_D2s_v3"\nvNetNewOrExisting="new"\nvirtualNetworkName="newVnet"\nvirtualNetworkResourceGroup=$(az group show --name myResourceGroup --query id -o tsv)\nsubnetName="subnet-1"\ndnsNameForPublicIP=$(echo "vm-$(az group show --name myResourceGroup --query id -o tsv)" | md5sum | cut -c 1-10)\nlocation="westus"\n\n# Define variables\ndiagStorageAccountName=$(echo "$(az group show --name myResourceGroup --query id -o tsv)specvm" | md5sum | cut -c 1-10)\nsubnetRef=$(az network vnet subnet show --resource-group $virtualNetworkResourceGroup --vnet-name $virtualNetworkName --name $subnetName --query id -o tsv)\nnicName="nic"\npublicIPAddressName="publicIp"\ndiskName="$vmName-disk"\n\n# Create resources\nif [ "$vNetNewOrExisting" = "new" ]; then\n  az network vnet create --name $virtualNetworkName --resource-group myResourceGroup --location $location --address-prefix 10.0.0.0/16\n  az network vnet subnet create --name $subnetName --resource-group myResourceGroup --vnet-name $virtualNetworkName --address-prefix 10.0.0.0/24\nfi\n\naz storage account create --name $diagStorageAccountName --resource-group myResourceGroup --location $location --sku Standard_LRS --kind Storage\n\naz network public-ip create --name $publicIPAddressName --resource-group myResourceGroup --location $location --dns-name $dnsNameForPublicIP --allocation-method Dynamic\n\naz network nic create --name $nicName --resource-group myResourceGroup --location $location --subnet $subnetRef --public-ip-address $publicIPAddressName\n\naz disk create --name $diskName --resource-group myResourceGroup --location $location --source $osDiskVhdUri --os-type $osType\n\naz vm create --name $vmName --resource-group myResourceGroup --location $location --size $vmSize --nics $nicName --attach-os-disk $diskName --os-type $osType --boot-diagnostics-storage $diagStorageAccountName\n```\n\nPlease replace `myResourceGroup` with your actual resource group name.


verify_result
{"diff_info": ["  ", "  Thedeploymentwillupdatethefollowingscope:", "  ", "  Scope:/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg", "  ", "  -Microsoft.CognitiveServices/accounts/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.CognitiveServices/accounts/cli-translator\\"", "  identity.type:\\"None\\"", "  kind:\\"FormRecognizer\\"", "  location:\\"westus2\\"", "  name:\\"cli-translator\\"", "  sku.name:\\"F0\\"", "  type:\\"Microsoft.CognitiveServices/accounts\\"", "  ", "  -Microsoft.DocumentDb/databaseAccounts/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.DocumentDb/databaseAccounts/cli-translator\\"", "  identity.type:\\"None\\"", "  kind:\\"GlobalDocumentDB\\"", "  location:\\"westus\\"", "  name:\\"cli-translator\\"", "  tags.defaultExperience:\\"Core(SQL)\\"", "  type:\\"Microsoft.DocumentDb/databaseAccounts\\"", "  ", "  -Microsoft.Search/searchServices/customdatasearch", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Search/searchServices/customdatasearch\\"", "  location:\\"westus2\\"", "  name:\\"customdatasearch\\"", "  sku.name:\\"standard\\"", "  tags.ProjectType:\\"aoai-your-data-service\\"", "  type:\\"Microsoft.Search/searchServices\\"", "  ", "  -Microsoft.Storage/storageAccounts/clitranslatorapi", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Storage/storageAccounts/clitranslatorapi\\"", "  kind:\\"Storage\\"", "  location:\\"westus\\"", "  name:\\"clitranslatorapi\\"", "  sku.name:\\"Standard_LRS\\"", "  sku.tier:\\"Standard\\"", "  type:\\"Microsoft.Storage/storageAccounts\\"", "  ", "  -Microsoft.Storage/storageAccounts/customdataforgpt", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Storage/storageAccounts/customdataforgpt\\"", "  kind:\\"StorageV2\\"", "  location:\\"eastus\\"", "  name:\\"customdataforgpt\\"", "  sku.name:\\"Standard_RAGRS\\"", "  sku.tier:\\"Standard\\"", "  tags.ProjectType:\\"aoai-your-data-service\\"", "  type:\\"Microsoft.Storage/storageAccounts\\"", "  ", "  -Microsoft.Storage/storageAccounts/translatortempfiles", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Storage/storageAccounts/translatortempfiles\\"", "  kind:\\"StorageV2\\"", "  location:\\"eastasia\\"", "  name:\\"translatortempfiles\\"", "  sku.name:\\"Standard_LRS\\"", "  sku.tier:\\"Standard\\"", "  type:\\"Microsoft.Storage/storageAccounts\\"", "  ", "  -Microsoft.Web/serverFarms/ASP-clitranslatorrg-bdc9", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Web/serverFarms/ASP-clitranslatorrg-bdc9\\"", "  kind:\\"functionapp\\"", "  location:\\"westus\\"", "  name:\\"ASP-clitranslatorrg-bdc9\\"", "  sku.capacity:0", "  sku.family:\\"Y\\"", "  sku.name:\\"Y1\\"", "  sku.size:\\"Y1\\"", "  sku.tier:\\"Dynamic\\"", "  type:\\"Microsoft.Web/serverFarms\\"", "  ", "  -Microsoft.Web/sites/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Web/sites/cli-translator\\"", "  kind:\\"functionapp,linux\\"", "  location:\\"westus\\"", "  name:\\"cli-translator\\"", "  tags.hidden-link:/app-insights-conn-string:\\"InstrumentationKey=11b638ce-0c16-42cc-9516-58122a1922ef;IngestionEndpoint=https://westus-0.in.applicationinsights.azure.com/;LiveEndpoint=https://westus.livediagnostics.monitor.azure.com/\\"", "  tags.hidden-link:/app-insights-instrumentation-key:\\"11b638ce-0c16-42cc-9516-58122a1922ef\\"", "  tags.hidden-link:/app-insights-resource-id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/microsoft.insights/components/cli-translator\\"", "  type:\\"Microsoft.Web/sites\\"", "  ", "  -microsoft.alertsmanagement/smartDetectorAlertRules/FailureAnomalies-cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/microsoft.alertsmanagement/smartDetectorAlertRules/FailureAnomalies-cli-translator\\"", "  location:\\"global\\"", "  name:\\"FailureAnomalies-cli-translator\\"", "  type:\\"microsoft.alertsmanagement/smartDetectorAlertRules\\"", "  ", "  -microsoft.insights/components/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/microsoft.insights/components/cli-translator\\"", "  kind:\\"web\\"", "  location:\\"westus\\"", "  name:\\"cli-translator\\"", "  type:\\"microsoft.insights/components\\"", "  ", "  +Microsoft.Compute/disks/newvm-disk[]", "  ", "  apiVersion:\\"\\"", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Compute/disks/newvm-disk\\"", "  location:\\"westus\\"", "  name:\\"newvm-disk\\"", "  properties.creationData.createOption:\\"Import\\"", "  properties.creationData.sourceUri:\\"zytest\\"", "  properties.osType:\\"Windows\\"", "  type:\\"Microsoft.Compute/disks\\"", "  ", "  +Microsoft.Compute/virtualMachines/newvm[]", "  ", "  apiVersion:\\"\\"", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Compute/virtualMachines/newvm\\"", "  location:\\"westus\\"", "  name:\\"newvm\\"", "  properties.diagnosticsProfile.bootDiagnostics.enabled:true", "- properties.diagnosticsProfile.bootDiagnostics.storageUri:\\"[reference(variables(\'diagStorageAccountName\')).primaryEndpoints.blob]\\"", "?                                                                      ^  - ^^\\n", "+ properties.diagnosticsProfile.bootDiagnostics.storageUri:\\"[reference(resourceId(\'Microsoft.Storage/storageAccounts\',parameters(\'diagStorageAccountName\')),\'\').primaryEndpoints.blob]\\"", "?                                                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^   ^ +++                            ++++\\n", "  properties.hardwareProfile.vmSize:\\"Standard_D2s_v3\\"", "  properties.networkProfile.networkInterfaces:[", "  0:", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Network/networkInterfaces/nic\\"", "  ", "  ]", "  properties.storageProfile.osDisk.createOption:\\"Attach\\"", "  properties.storageProfile.osDisk.managedDisk.id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Compute/disks/newvm-disk\\"", "+ properties.storageProfile.osDisk.name:\\"newvm-disk\\"", "  properties.storageProfile.osDisk.osType:\\"Windows\\"", "- tags.displayName:\\"VirtualMachine\\"", "  tags.platformsettings.host_environment.service.platform_optedin_for_rootcerts:\\"true\\"", "  type:\\"Microsoft.Compute/virtualMachines\\"", "  ", "  +Microsoft.Network/networkInterfaces/nic[]", "  ", "  apiVersion:\\"\\"", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Network/networkInterfaces/nic\\"", "  location:\\"westus\\"", "  name:\\"nic\\"", "  properties.ipConfigurations:[", "  0:", "  ", "  name:\\"ipconfig1\\"", "  properties.privateIPAllocationMethod:\\"Dynamic\\"", "  properties.publicIPAddress.id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Network/publicIPAddresses/publicIp\\"", "  properties.subnet.id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Network/virtualNetworks/newVnet/subnets/subnet-1\\"", "  ", "  ]", "- tags.displayName:\\"NetworkInterface\\"", "  type:\\"Microsoft.Network/networkInterfaces\\"", "  ", "  +Microsoft.Network/publicIPAddresses/publicIp[]", "  ", "  apiVersion:\\"\\"", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Network/publicIPAddresses/publicIp\\"", "  location:\\"westus\\"", "  name:\\"publicIp\\"", "  properties.dnsSettings.domainNameLabel:\\"vm-46d7cboj2kpoc\\"", "  properties.publicIPAllocationMethod:\\"Dynamic\\"", "- tags.displayName:\\"PublicIPAddress\\"", "  type:\\"Microsoft.Network/publicIPAddresses\\"", "  ", "  +Microsoft.Network/virtualNetworks/newVnet[]", "  ", "  apiVersion:\\"\\"", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Network/virtualNetworks/newVnet\\"", "  location:\\"westus\\"", "  name:\\"newVnet\\"", "  properties.addressSpace.addressPrefixes:[", "  0:\\"10.0.0.0/16\\"", "  ]", "  properties.subnets:[", "  0:", "  ", "  name:\\"subnet-1\\"", "  properties.addressPrefix:\\"10.0.0.0/24\\"", "  ", "  ]", "  type:\\"Microsoft.Network/virtualNetworks\\"", "  ", "  +Microsoft.Storage/storageAccounts/46d7cboj2kpocspecvm[]", "  ", "  apiVersion:\\"\\"", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Storage/storageAccounts/46d7cboj2kpocspecvm\\"", "  kind:\\"Storage\\"", "  location:\\"westus\\"", "  name:\\"46d7cboj2kpocspecvm\\"", "  sku.name:\\"Standard_LRS\\"", "  type:\\"Microsoft.Storage/storageAccounts\\"", "  ", "  Resourcechanges:10todelete,6tocreate."], "diff_summary": {"added": 2, "deleted": 4, "differential_rate": "0.031"}}