arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"adminUsername": {"type": "string", "metadata": {"description": "Name of existing VM Scale Set"}, "defaultValue": "zytest"}, "location": {"type": "string", "defaultValue": "westus", "metadata": {"description": "Location for all resources."}}, "authenticationType": {"type": "string", "defaultValue": "sshPublicKey", "allowedValues": ["sshPublicKey", "password"], "metadata": {"description": "Type of authentication to use on the Virtual Machine. SSH key is recommended."}}, "adminPasswordOrKey": {"type": "securestring", "metadata": {"description": "SSH Key or password for the Virtual Machine. SSH key is recommended."}, "defaultValue": "zytest"}}, "variables": {"namingInfix": "existingvmss", "existingVmssName": "existingvmss", "virtualNetworkName": "[concat(variables(\'namingInfix\'), \'vnet\')]", "publicIPAddressName": "[concat(variables(\'namingInfix\'), \'pip\')]", "subnetName": "[concat(variables(\'namingInfix\'), \'subnet\')]", "loadBalancerName": "[concat(variables(\'namingInfix\'), \'lb\')]", "natPoolName": "[concat(variables(\'namingInfix\'), \'natpool\')]", "bePoolName": "[concat(variables(\'namingInfix\'), \'bepool\')]", "linuxConfiguration": {"disablePasswordAuthentication": true, "ssh": {"publicKeys": [{"path": "[concat(\'/home/\', parameters(\'adminUsername\'), \'/.ssh/authorized_keys\')]", "keyData": "[parameters(\'adminPasswordOrKey\')]"}]}}}, "resources": [{"type": "Microsoft.Network/virtualNetworks", "name": "[variables(\'virtualNetworkName\')]", "location": "[parameters(\'location\')]", "apiVersion": "2021-02-01", "properties": {"addressSpace": {"addressPrefixes": ["10.0.0.0/16"]}, "subnets": [{"name": "[variables(\'subnetName\')]", "properties": {"addressPrefix": "10.0.0.0/24"}}]}}, {"type": "Microsoft.Network/publicIPAddresses", "name": "[variables(\'publicIPAddressName\')]", "location": "[parameters(\'location\')]", "apiVersion": "2021-02-01", "properties": {"publicIPAllocationMethod": "Dynamic", "dnsSettings": {"domainNameLabel": "[toLower(substring(concat(variables(\'existingVmssName\'), uniqueString(resourceGroup().id)), 0, 16))]"}}}, {"type": "Microsoft.Network/loadBalancers", "name": "[variables(\'loadBalancerName\')]", "location": "[parameters(\'location\')]", "apiVersion": "2021-02-01", "dependsOn": ["[resourceId(\'Microsoft.Network/publicIPAddresses/\', variables(\'publicIPAddressName\'))]"], "properties": {"frontendIPConfigurations": [{"name": "LoadBalancerFrontEnd", "properties": {"publicIPAddress": {"id": "[resourceId(\'Microsoft.Network/publicIPAddresses\',variables(\'publicIPAddressName\'))]"}}}], "backendAddressPools": [{"name": "[variables(\'bePoolName\')]"}], "inboundNatPools": [{"name": "[variables(\'natPoolName\')]", "properties": {"frontendIPConfiguration": {"id": "[resourceId(\'Microsoft.Network/loadBalancers/frontendIPConfigurations\', variables(\'loadBalancerName\'), \'loadBalancerFrontEnd\')]"}, "protocol": "tcp", "frontendPortRangeStart": 50000, "frontendPortRangeEnd": 50119, "backendPort": 3389}}]}}, {"type": "Microsoft.Compute/virtualMachineScaleSets", "name": "[variables(\'existingVmssName\')]", "location": "[parameters(\'location\')]", "apiVersion": "2021-04-01", "dependsOn": ["[resourceId(\'Microsoft.Network/loadBalancers/\', variables(\'loadBalancerName\'))]", "[resourceId(\'Microsoft.Network/virtualNetworks/\', variables(\'virtualNetworkName\'))]"], "sku": {"name": "Standard_D2_v3", "tier": "Standard", "capacity": 2}, "properties": {"overprovision": true, "upgradePolicy": {"mode": "Automatic"}, "virtualMachineProfile": {"storageProfile": {"osDisk": {"createOption": "FromImage"}, "imageReference": {"publisher": "RedHat", "offer": "RHEL", "sku": "7.5", "version": "latest"}}, "osProfile": {"computerNamePrefix": "existvmss", "adminUsername": "[parameters(\'adminUsername\')]", "adminPassword": "[parameters(\'adminPasswordOrKey\')]", "linuxConfiguration": "[if(equals(parameters(\'authenticationType\'), \'password\'), json(\'null\'), variables(\'linuxConfiguration\'))]"}, "networkProfile": {"networkInterfaceConfigurations": [{"name": "[concat(variables(\'namingInfix\'), \'nic\')]", "properties": {"primary": true, "ipConfigurations": [{"name": "[concat(variables(\'namingInfix\'), \'ipconfig\')]", "properties": {"subnet": {"id": "[resourceId(\'Microsoft.Network/virtualNetworks/subnets\', variables(\'virtualNetworkName\'), variables(\'subnetName\'))]"}, "loadBalancerBackendAddressPools": [{"id": "[resourceId(\'Microsoft.Network/loadBalancers/backendAddressPools\', variables(\'loadBalancerName\'), variables(\'bePoolName\'))]"}], "loadBalancerInboundNatPools": [{"id": "[resourceId(\'Microsoft.Network/loadBalancers/inboundNatPools\', variables(\'loadBalancerName\'), variables(\'natPoolName\'))]"}]}}]}}]}}}}], "outputs": {"existingVmssName": {"type": "string", "value": "[variables(\'existingVmssName\')]"}}}


cli_script
Here is the equivalent CLI script:\n\n```bash\n#!/bin/bash\n\n# Define parameters\nadminUsername="zytest"\nlocation="westus"\nauthenticationType="sshPublicKey"\nadminPasswordOrKey="zytest"\n\n# Define variables\nnamingInfix="existingvmss"\nexistingVmssName="existingvmss"\nvirtualNetworkName="${namingInfix}vnet"\npublicIPAddressName="${namingInfix}pip"\nsubnetName="${namingInfix}subnet"\nloadBalancerName="${namingInfix}lb"\nnatPoolName="${namingInfix}natpool"\nbePoolName="${namingInfix}bepool"\nlinuxConfiguration=\'{"disablePasswordAuthentication": true, "ssh": {"publicKeys": [{"path": "/home/${adminUsername}/.ssh/authorized_keys", "keyData": "${adminPasswordOrKey}"}]}}\'\n\n# Create resources\naz network vnet create --name $virtualNetworkName --location $location --address-prefix 10.0.0.0/16 --subnet-name $subnetName --subnet-prefix 10.0.0.0/24\n\naz network public-ip create --name $publicIPAddressName --location $location --allocation-method Dynamic\n\naz network lb create --name $loadBalancerName --location $location --frontend-ip-name LoadBalancerFrontEnd --public-ip-address $publicIPAddressName\n\naz network lb address-pool create --lb-name $loadBalancerName --name $bePoolName\n\naz network lb inbound-nat-pool create --lb-name $loadBalancerName --name $natPoolName --protocol tcp --frontend-port-range-start 50000 --frontend-port-range-end 50119 --backend-port 3389\n\naz vmss create --name $existingVmssName --location $location --vm-sku Standard_D2_v3 --instance-count 2 --admin-username $adminUsername --admin-password $adminPasswordOrKey --authentication-type $authenticationType --vnet-name $virtualNetworkName --subnet $subnetName --public-ip-address $publicIPAddressName --load-balancer $loadBalancerName\n\n# Output\necho "Existing VMSS Name: $existingVmssName"\n```\n\nPlease note that this script assumes that you have the Azure CLI installed and configured with the appropriate permissions to create these resources.


verify_result
{"diff_info": ["  ", "  Thedeploymentwillupdatethefollowingscope:", "  ", "  Scope:/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg", "  ", "  -Microsoft.CognitiveServices/accounts/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.CognitiveServices/accounts/cli-translator\\"", "  identity.type:\\"None\\"", "  kind:\\"FormRecognizer\\"", "  location:\\"westus2\\"", "  name:\\"cli-translator\\"", "  sku.name:\\"F0\\"", "  type:\\"Microsoft.CognitiveServices/accounts\\"", "  ", "  -Microsoft.DocumentDb/databaseAccounts/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.DocumentDb/databaseAccounts/cli-translator\\"", "  identity.type:\\"None\\"", "  kind:\\"GlobalDocumentDB\\"", "  location:\\"westus\\"", "  name:\\"cli-translator\\"", "  tags.defaultExperience:\\"Core(SQL)\\"", "  type:\\"Microsoft.DocumentDb/databaseAccounts\\"", "  ", "  -Microsoft.Search/searchServices/customdatasearch", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Search/searchServices/customdatasearch\\"", "  location:\\"westus2\\"", "  name:\\"customdatasearch\\"", "  sku.name:\\"standard\\"", "  tags.ProjectType:\\"aoai-your-data-service\\"", "  type:\\"Microsoft.Search/searchServices\\"", "  ", "  -Microsoft.Storage/storageAccounts/clitranslatorapi", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Storage/storageAccounts/clitranslatorapi\\"", "  kind:\\"Storage\\"", "  location:\\"westus\\"", "  name:\\"clitranslatorapi\\"", "  sku.name:\\"Standard_LRS\\"", "  sku.tier:\\"Standard\\"", "  type:\\"Microsoft.Storage/storageAccounts\\"", "  ", "  -Microsoft.Storage/storageAccounts/customdataforgpt", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Storage/storageAccounts/customdataforgpt\\"", "  kind:\\"StorageV2\\"", "  location:\\"eastus\\"", "  name:\\"customdataforgpt\\"", "  sku.name:\\"Standard_RAGRS\\"", "  sku.tier:\\"Standard\\"", "  tags.ProjectType:\\"aoai-your-data-service\\"", "  type:\\"Microsoft.Storage/storageAccounts\\"", "  ", "  -Microsoft.Storage/storageAccounts/translatortempfiles", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Storage/storageAccounts/translatortempfiles\\"", "  kind:\\"StorageV2\\"", "  location:\\"eastasia\\"", "  name:\\"translatortempfiles\\"", "  sku.name:\\"Standard_LRS\\"", "  sku.tier:\\"Standard\\"", "  type:\\"Microsoft.Storage/storageAccounts\\"", "  ", "  -Microsoft.Web/serverFarms/ASP-clitranslatorrg-bdc9", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Web/serverFarms/ASP-clitranslatorrg-bdc9\\"", "  kind:\\"functionapp\\"", "  location:\\"westus\\"", "  name:\\"ASP-clitranslatorrg-bdc9\\"", "  sku.capacity:0", "  sku.family:\\"Y\\"", "  sku.name:\\"Y1\\"", "  sku.size:\\"Y1\\"", "  sku.tier:\\"Dynamic\\"", "  type:\\"Microsoft.Web/serverFarms\\"", "  ", "  -Microsoft.Web/sites/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Web/sites/cli-translator\\"", "  kind:\\"functionapp,linux\\"", "  location:\\"westus\\"", "  name:\\"cli-translator\\"", "  tags.hidden-link:/app-insights-conn-string:\\"InstrumentationKey=11b638ce-0c16-42cc-9516-58122a1922ef;IngestionEndpoint=https://westus-0.in.applicationinsights.azure.com/;LiveEndpoint=https://westus.livediagnostics.monitor.azure.com/\\"", "  tags.hidden-link:/app-insights-instrumentation-key:\\"11b638ce-0c16-42cc-9516-58122a1922ef\\"", "  tags.hidden-link:/app-insights-resource-id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/microsoft.insights/components/cli-translator\\"", "  type:\\"Microsoft.Web/sites\\"", "  ", "  -microsoft.alertsmanagement/smartDetectorAlertRules/FailureAnomalies-cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/microsoft.alertsmanagement/smartDetectorAlertRules/FailureAnomalies-cli-translator\\"", "  location:\\"global\\"", "  name:\\"FailureAnomalies-cli-translator\\"", "  type:\\"microsoft.alertsmanagement/smartDetectorAlertRules\\"", "  ", "  -microsoft.insights/components/cli-translator", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/microsoft.insights/components/cli-translator\\"", "  kind:\\"web\\"", "  location:\\"westus\\"", "  name:\\"cli-translator\\"", "  type:\\"microsoft.insights/components\\"", "  ", "  +Microsoft.Compute/virtualMachineScaleSets/existingvmss[]", "  ", "  apiVersion:\\"\\"", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Compute/virtualMachineScaleSets/existingvmss\\"", "  location:\\"westus\\"", "  name:\\"existingvmss\\"", "  properties.overprovision:true", "+ properties.sku.capacity:2", "+ properties.sku.name:\\"Standard_D2_v3\\"", "+ properties.sku.tier:\\"Standard\\"", "- properties.upgradePolicy.mode:\\"Automatic\\"", "?                                ^ --- ^^^\\n", "+ properties.upgradePolicy.mode:\\"Manual\\"", "?                                ^^^  ^\\n", "  properties.virtualMachineProfile.extensionProfile.extensions:[", "  0:", "  ", "- name:\\"Microsoft.Azure.Monitor.AzureMonitorLinuxAgent\\"", "+ name:\\"Microsoft.Azure.Security.AntimalwareSignature.AntimalwareConfiguration\\"", "  properties.autoUpgradeMinorVersion:true", "  properties.enableAutomaticUpgrade:true", "+ properties.publisher:\\"Microsoft.Azure.Security.AntimalwareSignature\\"", "+ properties.type:\\"AntimalwareConfiguration\\"", "- properties.publisher:\\"Microsoft.Azure.Monitor\\"", "- properties.settings.GCS_AUTO_CONFIG:true", "- properties.type:\\"AzureMonitorLinuxAgent\\"", "- properties.typeHandlerVersion:\\"1.0\\"", "?                                ^\\n", "+ properties.typeHandlerVersion:\\"2.0\\"", "?                                ^\\n", "  ", "  1:", "  ", "- name:\\"Microsoft.Azure.Security.Monitoring.AzureSecurityLinuxAgent\\"", "+ name:\\"Microsoft.Azure.Geneva.GenevaMonitoring\\"", "  properties.autoUpgradeMinorVersion:true", "  properties.enableAutomaticUpgrade:true", "- properties.protectedSettings:\\"*******\\"", "- properties.publisher:\\"Microsoft.Azure.Security.Monitoring\\"", "?                                       ^ --------- ^^^^^^^\\n", "+ properties.publisher:\\"Microsoft.Azure.Geneva\\"", "?                                       ^  ^^^\\n", "+ properties.type:\\"GenevaMonitoring\\"", "- properties.settings.enableAutoConfig:true", "- properties.settings.enableGenevaUpload:true", "- properties.settings.reportSuccessOnUnsupportedDistro:true", "- properties.type:\\"AzureSecurityLinuxAgent\\"", "  properties.typeHandlerVersion:\\"2.0\\"", "  ", "  ]", "  properties.virtualMachineProfile.networkProfile.networkInterfaceConfigurations:[", "  0:", "  ", "- name:\\"existingvmssnic\\"", "?                   ---\\n", "+ name:\\"existingvmss\\"", "  properties.ipConfigurations:[", "  0:", "  ", "- name:\\"existingvmssipconfig\\"", "+ name:\\"ipconfig\\"", "  properties.loadBalancerBackendAddressPools:[", "  0:", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Network/loadBalancers/existingvmsslb/backendAddressPools/existingvmssbepool\\"", "  ", "  ]", "  properties.loadBalancerInboundNatPools:[", "  0:", "  ", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Network/loadBalancers/existingvmsslb/inboundNatPools/existingvmssnatpool\\"", "  ", "  ]", "  properties.subnet.id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Network/virtualNetworks/existingvmssvnet/subnets/existingvmsssubnet\\"", "  ", "  ]", "  properties.primary:true", "  ", "  ]", "  properties.virtualMachineProfile.osProfile.adminPassword:\\"*******\\"", "  properties.virtualMachineProfile.osProfile.adminUsername:\\"zytest\\"", "- properties.virtualMachineProfile.osProfile.computerNamePrefix:\\"existvmss\\"", "+ properties.virtualMachineProfile.osProfile.computerNamePrefix:\\"existingvmss\\"", "?                                                                     +++\\n", "- properties.virtualMachineProfile.osProfile.linuxConfiguration.disablePasswordAuthentication:true", "?                                            ^  ^^              ^^^    --------   ^^^     ^^^\\n", "+ properties.virtualMachineProfile.osProfile.windowsConfiguration.enableAutomaticUpdates:true", "?                                            ^  ^^^^              ^^       ^^^   +++  ^^\\n", "- properties.virtualMachineProfile.osProfile.linuxConfiguration.ssh.publicKeys:[", "?                                            ^  ^^               ^^^^ ----- ----\\n", "+ properties.virtualMachineProfile.osProfile.windowsConfiguration.provisionVMAgent:true", "?                                            ^  ^^^^              +++++ ^^^^^^^^^^^^^\\n", "- 0:", "- ", "- keyData:\\"*******\\"", "- path:\\"*******\\"", "- ", "- ]", "- properties.virtualMachineProfile.storageProfile.imageReference.offer:\\"RHEL\\"", "?                                                                       ^^^^\\n", "+ properties.virtualMachineProfile.storageProfile.imageReference.offer:\\"WindowsServer\\"", "?                                                                       ^^^^^^^^^^^^^\\n", "- properties.virtualMachineProfile.storageProfile.imageReference.publisher:\\"RedHat\\"", "?                                                                           ^ ^^^^\\n", "+ properties.virtualMachineProfile.storageProfile.imageReference.publisher:\\"MicrosoftWindowsServer\\"", "?                                                                           ^^^^^^^^^^^^^^^^^ ^^^^\\n", "- properties.virtualMachineProfile.storageProfile.imageReference.sku:\\"7.5\\"", "?                                                                     ^^^\\n", "+ properties.virtualMachineProfile.storageProfile.imageReference.sku:\\"2016-Datacenter\\"", "?                                                                     ^^^^^^^^^^^^^^^\\n", "  properties.virtualMachineProfile.storageProfile.imageReference.version:\\"latest\\"", "  properties.virtualMachineProfile.storageProfile.osDisk.createOption:\\"FromImage\\"", "- sku.capacity:2", "- sku.name:\\"Standard_D2_v3\\"", "- sku.tier:\\"Standard\\"", "  tags.azsecpack:\\"nonprod\\"", "  tags.platformsettings.host_environment.service.platform_optedin_for_rootcerts:\\"true\\"", "  type:\\"Microsoft.Compute/virtualMachineScaleSets\\"", "  ", "  +Microsoft.Network/loadBalancers/existingvmsslb[]", "  ", "  apiVersion:\\"\\"", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Network/loadBalancers/existingvmsslb\\"", "  location:\\"westus\\"", "  name:\\"existingvmsslb\\"", "  properties.backendAddressPools:[", "  0:", "  ", "  name:\\"existingvmssbepool\\"", "  ", "  ]", "  properties.frontendIPConfigurations:[", "  0:", "  ", "  name:\\"LoadBalancerFrontEnd\\"", "  properties.publicIPAddress.id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Network/publicIPAddresses/existingvmsspip\\"", "  ", "  ]", "  properties.inboundNatPools:[", "  0:", "  ", "  name:\\"existingvmssnatpool\\"", "  properties.backendPort:3389", "- properties.frontendIPConfiguration.id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Network/loadBalancers/existingvmsslb/frontendIPConfigurations/loadBalancerFrontEnd\\"", "?                                                                                                                                                                                                               ^\\n", "+ properties.frontendIPConfiguration.id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Network/loadBalancers/existingvmsslb/frontendIPConfigurations/LoadBalancerFrontEnd\\"", "?                                                                                                                                                                                                               ^\\n", "  properties.frontendPortRangeEnd:50119", "  properties.frontendPortRangeStart:50000", "- properties.protocol:\\"tcp\\"", "?                      ^\\n", "+ properties.protocol:\\"Tcp\\"", "?                      ^\\n", "  ", "  ]", "  type:\\"Microsoft.Network/loadBalancers\\"", "  ", "  +Microsoft.Network/publicIPAddresses/existingvmsspip[]", "  ", "  apiVersion:\\"\\"", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Network/publicIPAddresses/existingvmsspip\\"", "  location:\\"westus\\"", "  name:\\"existingvmsspip\\"", "- properties.dnsSettings.domainNameLabel:\\"existingvmss46d7\\"", "  properties.publicIPAllocationMethod:\\"Dynamic\\"", "  type:\\"Microsoft.Network/publicIPAddresses\\"", "  ", "  +Microsoft.Network/virtualNetworks/existingvmssvnet[]", "  ", "  apiVersion:\\"\\"", "  id:\\"/subscriptions/6b085460-5f21-477e-ba44-1035046e9101/resourceGroups/cli-translator-rg/providers/Microsoft.Network/virtualNetworks/existingvmssvnet\\"", "  location:\\"westus\\"", "  name:\\"existingvmssvnet\\"", "  properties.addressSpace.addressPrefixes:[", "  0:\\"10.0.0.0/16\\"", "  ]", "  properties.subnets:[", "  0:", "  ", "  name:\\"existingvmsssubnet\\"", "  properties.addressPrefix:\\"10.0.0.0/24\\"", "  ", "  ]", "  type:\\"Microsoft.Network/virtualNetworks\\"", "  ", "  Resourcechanges:10todelete,4tocreate."], "diff_summary": {"added": 21, "deleted": 33, "differential_rate": "0.219"}}