arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"adminUsername": {"type": "string", "metadata": {"description": "Username for the Virtual Machine."}, "defaultValue": "zytest"}, "adminPassword": {"type": "securestring", "metadata": {"description": "Password for the Virtual Machine."}, "defaultValue": "zytest"}, "customScriptStorageAccountName": {"type": "string", "metadata": {"description": "Name of the storage account."}, "defaultValue": "zytest"}, "_artifactsLocation": {"type": "string", "metadata": {"description": "The base URI where artifacts required by this template are located. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated."}, "defaultValue": "[deployment().properties.templateLink.uri]"}, "_artifactsLocationSasToken": {"type": "securestring", "metadata": {"description": "The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated."}, "defaultValue": ""}, "location": {"type": "string", "defaultValue": "westus", "metadata": {"description": "Location for all resources."}}, "vmSize": {"type": "string", "defaultValue": "Standard_D2_v3", "metadata": {"description": "Default VM Size"}}}, "variables": {"nicName": "myVMNic", "addressPrefix": "10.0.0.0/16", "subnetName": "Subnet", "subnetPrefix": "10.0.0.0/24", "subnetRef": "[resourceId(\'Microsoft.Network/virtualNetworks/subnets\', variables(\'virtualNetworkName\'), variables(\'subnetName\'))]", "vmName": "MyVM", "virtualNetworkName": "MyVNET", "publicIPAddressName": "myPublicIP", "fileToBeCopied": "FileToBeCopied.txt", "scriptFolder": "scripts", "scriptFileName": "Copy-FileFromAzure.ps1", "accountid": "[resourceId(\'Microsoft.Storage/storageAccounts/\', parameters(\'customScriptStorageAccountName\'))]", "scriptParameters": "[concat(\'-artifactsLocation \', replace(parameters(\'_artifactsLocation\'),parameters(\'_artifactsLocationSasToken\'),\'\'), \' -artifactsLocationSasToken \\"\', parameters(\'_artifactsLocationSasToken\'), \'\\" -folderName \', variables(\'scriptFolder\'), \' -fileToInstall \', variables(\'fileToBeCopied\'))]", "networkSecurityGroupName": "default-NSG"}, "resources": [{"apiVersion": "2020-08-01", "type": "Microsoft.Network/publicIPAddresses", "name": "[variables(\'publicIPAddressName\')]", "location": "[parameters(\'location\')]", "properties": {"publicIPAllocationMethod": "Dynamic"}}, {"comments": "Default Network Security Group for template", "type": "Microsoft.Network/networkSecurityGroups", "apiVersion": "2020-08-01", "name": "[variables(\'networkSecurityGroupName\')]", "location": "[parameters(\'location\')]", "properties": {"securityRules": [{"name": "default-allow-3389", "properties": {"priority": 1000, "access": "Allow", "direction": "Inbound", "destinationPortRange": "3389", "protocol": "Tcp", "sourceAddressPrefix": "*", "sourcePortRange": "*", "destinationAddressPrefix": "*"}}]}}, {"apiVersion": "2020-08-01", "type": "Microsoft.Network/virtualNetworks", "name": "[variables(\'virtualNetworkName\')]", "location": "[parameters(\'location\')]", "dependsOn": ["[resourceId(\'Microsoft.Network/networkSecurityGroups\', variables(\'networkSecurityGroupName\'))]"], "properties": {"addressSpace": {"addressPrefixes": ["[variables(\'addressPrefix\')]"]}, "subnets": [{"name": "[variables(\'subnetName\')]", "properties": {"addressPrefix": "[variables(\'subnetPrefix\')]", "networkSecurityGroup": {"id": "[resourceId(\'Microsoft.Network/networkSecurityGroups\', variables(\'networkSecurityGroupName\'))]"}}}]}}, {"apiVersion": "2020-08-01", "type": "Microsoft.Network/networkInterfaces", "name": "[variables(\'nicName\')]", "location": "[parameters(\'location\')]", "dependsOn": ["[variables(\'publicIPAddressName\')]", "[variables(\'virtualNetworkName\')]"], "properties": {"ipConfigurations": [{"name": "ipconfig1", "properties": {"privateIPAllocationMethod": "Dynamic", "publicIPAddress": {"id": "[resourceId(\'Microsoft.Network/publicIPAddresses\',variables(\'publicIPAddressName\'))]"}, "subnet": {"id": "[variables(\'subnetRef\')]"}}}]}}, {"apiVersion": "2020-12-01", "type": "Microsoft.Compute/virtualMachines", "name": "[variables(\'vmName\')]", "location": "[parameters(\'location\')]", "dependsOn": ["[variables(\'nicName\')]"], "properties": {"hardwareProfile": {"vmSize": "[parameters(\'vmSize\')]"}, "osProfile": {"computerName": "[variables(\'vmName\')]", "adminUsername": "[parameters(\'adminUsername\')]", "adminPassword": "[parameters(\'adminPassword\')]"}, "storageProfile": {"imageReference": {"publisher": "MicrosoftWindowsServer", "offer": "WindowsServer", "sku": "2016-Datacenter", "version": "latest"}, "osDisk": {"createOption": "FromImage"}}, "networkProfile": {"networkInterfaces": [{"id": "[resourceId(\'Microsoft.Network/networkInterfaces\',variables(\'nicName\'))]"}]}}, "resources": [{"type": "extensions", "name": "CustomScriptExtension", "apiVersion": "2020-12-01", "location": "[parameters(\'location\')]", "dependsOn": ["[variables(\'vmName\')]"], "properties": {"publisher": "Microsoft.Compute", "type": "CustomScriptExtension", "typeHandlerVersion": "1.8", "autoUpgradeMinorVersion": true, "settings": {"fileUris": ["[uri(parameters(\'_artifactsLocation\'), concat(variables(\'scriptFolder\'),\'/\',variables(\'scriptFileName\'), parameters(\'_artifactsLocationSasToken\')))]"], "commandToExecute": "[concat(\'powershell -ExecutionPolicy Unrestricted -File \', variables(\'scriptFolder\'), \'/\', variables(\'scriptFileName\'), \' \', variables(\'scriptParameters\'))]"}, "protectedSettings": {"storageAccountName": "[parameters(\'customScriptStorageAccountName\')]", "storageAccountKey": "[listKeys(variables(\'accountid\'),\'2021-01-01\').keys[0].value]"}}}]}]}


cli_script
Below is the translated Azure CLI script based on the provided ARM template and template parameters.\n\n```bash\n#!/bin/bash\n\n# Assign parameters to variables\nadminUsername="zytest"\nadminPassword="zytest"\ncustomScriptStorageAccountName="zytest"\n_artifactsLocation="[deployment().properties.templateLink.uri]"\n_artifactsLocationSasToken=""\nlocation="westus"\nvmSize="Standard_D2_v3"\n\n# Define variables\nnicName="myVMNic"\naddressPrefix="10.0.0.0/16"\nsubnetName="Subnet"\nsubnetPrefix="10.0.0.0/24"\nvirtualNetworkName="MyVNET"\npublicIPAddressName="myPublicIP"\nvmName="MyVM"\nnetworkSecurityGroupName="default-NSG"\nfileToBeCopied="FileToBeCopied.txt"\nscriptFolder="scripts"\nscriptFileName="Copy-FileFromAzure.ps1"\n\n# Create a public IP address\naz network public-ip create \\\n    --name $publicIPAddressName \\\n    --location $location \\\n    --allocation-method Dynamic\n\n# Create a network security group and rule\naz network nsg create \\\n    --name $networkSecurityGroupName \\\n    --location $location\n\naz network nsg rule create \\\n    --nsg-name $networkSecurityGroupName \\\n    --name default-allow-3389 \\\n    --priority 1000 \\\n    --access Allow \\\n    --direction Inbound \\\n    --destination-port-range 3389 \\\n    --protocol Tcp \\\n    --source-address-prefix "*" \\\n    --source-port-range "*" \\\n    --destination-address-prefix "*"\n\n# Create a virtual network and subnet\naz network vnet create \\\n    --name $virtualNetworkName \\\n    --location $location \\\n    --address-prefix $addressPrefix \\\n    --subnet-name $subnetName \\\n    --subnet-prefix $subnetPrefix\n\n# Associate the network security group to the subnet\naz network vnet subnet update \\\n    --vnet-name $virtualNetworkName \\\n    --name $subnetName \\\n    --network-security-group $networkSecurityGroupName\n\n# Create a network interface\naz network nic create \\\n    --name $nicName \\\n    --location $location \\\n    --vnet-name $virtualNetworkName \\\n    --subnet $subnetName \\\n    --public-ip-address $publicIPAddressName\n\n# Create a virtual machine\naz vm create \\\n    --name $vmName \\\n    --location $location \\\n    --nics $nicName \\\n    --image Win2016Datacenter \\\n    --admin-username $adminUsername \\\n    --admin-password $adminPassword \\\n    --size $vmSize\n\n# Retrieve storage account key\nstorageAccountKey=$(az storage account keys list \\\n    --account-name $customScriptStorageAccountName \\\n    --query \'[0].value\' --output tsv)\n\n# Create Custom Script Extension for the virtual machine\naz vm extension set \\\n    --vm-name $vmName \\\n    --name CustomScriptExtension \\\n    --publisher Microsoft.Compute \\\n    --version 1.8 \\\n    --settings "{\\"fileUris\\": [\\"$(az storage blob url --account-name $customScriptStorageAccountName --container-name $scriptFolder --name $scriptFileName --output tsv)\\"],\\"commandToExecute\\": \\"powershell -ExecutionPolicy Unrestricted -File $scriptFolder/$scriptFileName -artifactsLocation $_artifactsLocation -artifactsLocationSasToken $_artifactsLocationSasToken -folderName $scriptFolder -fileToInstall $fileToBeCopied\\"}" \\\n    --protected-settings "{\\"storageAccountName\\": \\"$customScriptStorageAccountName\\", \\"storageAccountKey\\": \\"$storageAccountKey\\"}"\n```\n\nThis script should be executed in a Bash environment with Azure CLI installed and logged in to an Azure account. It creates the resources defined in the ARM template using Azure CLI commands. Each resource type from the ARM template has been translated to the corresponding Azure CLI command. The parameters and variables have been translated to shell variables at the top of the script.


verify_result
