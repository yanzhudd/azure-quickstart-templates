arm_template
{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"location": {"metadata": {"description": "The Location For the resources"}, "type": "string", "defaultValue": "westus"}, "extensionName": {"type": "string", "metadata": {"description": "name of the extension"}, "defaultValue": "zytest"}, "vmName": {"metadata": {"description": "The name of the vm"}, "type": "string", "defaultValue": "zytest"}, "fileUris": {"type": "array", "defaultValue": "zytest"}, "commandToExecute": {"type": "string", "defaultValue": "zytest"}, "isWindowsOS": {"type": "bool", "defaultValue": "zytest"}}, "variables": {"extensionNameWindows": "[concat(parameters(\'extensionName\'), \'-windows\')]", "extensionNameLinux": "[concat(parameters(\'extensionName\'), \'-linux\')]"}, "resources": [{"condition": "[parameters(\'isWindowsOS\')]", "type": "Microsoft.Compute/virtualMachines/extensions", "apiVersion": "2020-12-01", "name": "[concat(parameters(\'vmName\'), \'/\', variables(\'extensionNameWindows\'))]", "location": "[parameters(\'location\')]", "properties": {"publisher": "Microsoft.Compute", "type": "CustomScriptExtension", "typeHandlerVersion": "1.8", "autoUpgradeMinorVersion": true, "settings": {"fileUris": "[parameters(\'fileUris\')]", "commandToExecute": "[parameters(\'commandToExecute\')]"}}}, {"condition": "[not(parameters(\'isWindowsOS\'))]", "type": "Microsoft.Compute/virtualMachines/extensions", "apiVersion": "2017-03-30", "name": "[concat(parameters(\'vmName\'), \'/\', variables(\'extensionNameLinux\'))]", "location": "[parameters(\'location\')]", "properties": {"publisher": "Microsoft.Azure.Extensions", "type": "CustomScript", "typeHandlerVersion": "2.0", "autoUpgradeMinorVersion": true, "settings": {"fileUris": "[parameters(\'fileUris\')]"}, "protectedSettings": {"commandToExecute": "[parameters(\'commandToExecute\')]"}}}], "outputs": {"instanceView": {"value": "[reference(if(parameters(\'isWindowsOS\'), resourceId(\'Microsoft.Compute/virtualMachines/extensions\', parameters(\'vmName\'), variables(\'extensionNameWindows\')), resourceId(\'Microsoft.Compute/virtualMachines/extensions\', parameters(\'vmName\'), variables(\'extensionNameLinux\')))).instanceView]", "type": "object"}}}


cli_script
Based on the provided ARM template and parameters, the following bash script can be used to create the resources using the Azure CLI:\n\n```bash\n#!/bin/bash\n\n# Assigning parameter values to variables\nlocation="westus" # Default value, can be overridden by TemplateParameters\nextensionName="zytest" # Default value, can be overridden by TemplateParameters\nvmName="zytest" # Default value, can be overridden by TemplateParameters\nfileUris=("zytest") # Default value, can be overridden by TemplateParameters\ncommandToExecute="zytest" # Default value, can be overridden by TemplateParameters\nisWindowsOS=false # Default value, can be overridden by TemplateParameters\n\n# Concatenate extension names based on OS\nextensionNameWindows="${extensionName}-windows"\nextensionNameLinux="${extensionName}-linux"\n\n# Check if the OS is Windows and create the extension accordingly\nif [ "$isWindowsOS" = true ]; then\n    # Create Windows VM extension\n    az vm extension set \\\n        --resource-group <ResourceGroup> \\\n        --vm-name $vmName \\\n        --name $extensionNameWindows \\\n        --location $location \\\n        --publisher "Microsoft.Compute" \\\n        --extension-type "CustomScriptExtension" \\\n        --version "1.8" \\\n        --settings "{\\"fileUris\\": ${fileUris[@]}, \\"commandToExecute\\": \\"$commandToExecute\\"}"\nelse\n    # Create Linux VM extension\n    az vm extension set \\\n        --resource-group <ResourceGroup> \\\n        --vm-name $vmName \\\n        --name $extensionNameLinux \\\n        --location $location \\\n        --publisher "Microsoft.Azure.Extensions" \\\n        --extension-type "CustomScript" \\\n        --version "2.0" \\\n        --settings "{\\"fileUris\\": ${fileUris[@]}}" \\\n        --protected-settings "{\\"commandToExecute\\": \\"$commandToExecute\\"}"\nfi\n```\n\nPlease replace `<ResourceGroup>` with your actual resource group name where the virtual machine is located. Also, ensure that the `fileUris` array is properly formatted as JSON when setting the `--settings` parameter in the CLI commands.\n\nNote that the `TemplateParameters` provided in the JSON data are all default values. If you have actual values to override the defaults, replace the variables\' values at the top of the bash script accordingly.\n\nRemember to give execution permission to the script before running it with `chmod +x scriptname.sh`.


verify_result
